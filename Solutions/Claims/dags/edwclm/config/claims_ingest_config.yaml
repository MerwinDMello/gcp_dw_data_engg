v_sourcesysnm: claims    
v_databasetype: sqlserver
v_database: ClaimsConnectDB
v_port: 1433
v_secret_name: revapp_claims_remits_sql/versions/latest
v_jdbc_class_name: com.microsoft.sqlserver.jdbc.SQLServerDriver
v_jdbc_jar: mssql-jdbc-12.4.0.jre8.jar
v_jdkfile: jre-8u351-linux-x64.tar.gz
v_jdkversion: jre1.8.0_351
v_jdbcbqpytemplate: Jdbc_to_BigQuery_PythonTemplate.py
v_machine_type: n1-standard-4

# Lists based on dependencies
# tblist [srctableid~srctablename~tgttablename~tgttableloadtype~srctablequery~rowcommitsize]
tblist1: [
  "1~ClaimsConnectDB.dbo.Dw_Billing_Provider~v_clm_stage_dataset_name.lu_billing_provider~append~SELECT bill_provider_addr1, bill_provider_addr2, bill_prov_provider_city AS bill_provider_city, bill_provider_name, bill_provider_npi, billing_provider_sid AS bill_provider_sid, bill_provider_st, bill_provider_zip AS bill_provider_zip_cd, dw_last_update_date_time, source_system_code FROM claimsconnectdb.dbo.dw_billing_provider WITH (nolock)~100000",
  "2~ClaimsConnectDB.dbo.Dw_Pay_To_Provider~v_clm_stage_dataset_name.lu_pay_to_provider~append~SELECT provider_addr1 AS pay_to_provider_addr1, provider_addr2 AS pay_to_provider_addr2, provider_city AS pay_to_provider_city, provider_name AS pay_to_provider_name, pay_to_provider_sid, provider_st AS pay_to_provider_st, provider_zip pay_to_provider_zip_cd, dw_last_update_date_time, source_system_code FROM claimsconnectdb.dbo.dw_pay_to_provider WITH (nolock)~100000",
  "3~ClaimsConnectDB.dbo.Fact_Claim~v_clm_stage_dataset_name.fact_claim~append~SELECT claim_id, vendor_cid, unit_num, unit_num AS numeric_unit_num, numeric_patient_acct_num, service_code, taxonomy_code, destination_method, bill_type_code, stgb.billing_provider_sid AS bill_provider_sid, stgp.pay_to_provider_sid AS pay_to_provider_sid, total_charge_amt, payor_seq_ind, iplan_id, bill_dt, (CASE SUBSTRING(patient_acc_num, 1, 1) WHEN 'D' THEN SUBSTRING(patient_acc_num, 2, 39) WHEN 'R' THEN SUBSTRING(patient_acc_num, 2, 39) WHEN 'H' THEN SUBSTRING(patient_acc_num, 2, 39) WHEN 'S' THEN SUBSTRING(patient_acc_num, 2, 39) WHEN 'P' THEN SUBSTRING(patient_acc_num, 2, 39) ELSE patient_acc_num END)AS patient_acct_num, med_rec_num, fed_tax_num, CAST(stmt_cover_from_dt AS DATE) AS stmt_cover_from_dt, CAST(stmt_cover_to_dt AS DATE) AS stmt_cover_to_dt, CAST(admission_dt AS DATE) AS admission_dt, CAST(admission_hr AS CHAR(2)) AS admission_hr, admission_type_ind, admission_source AS admission_source_cd, CAST(discharge_hr AS CHAR(2)) AS discharge_hr, discharge_status AS discharge_status_cd, accident_state AS accident_st, npi, admit_diag_code, drg, claim_remark AS claim_desc, SUBSTRING(archive_file_location, 1, datalength(archive_file_location) - charindex(CHAR(92), reverse(archive_file_location))) AS file_link_path_txt, SUBSTRING(archive_file_location, datalength(archive_file_location) - charindex(CHAR(92), reverse(archive_file_location)) + 2, charindex(CHAR(92), reverse(archive_file_location)) - 1) AS claim_file_name, (CASE SUBSTRING(patient_acc_num, 1, 1) WHEN 'D' THEN 'D' WHEN 'R' THEN 'R' WHEN 'H' THEN 'H' WHEN 'S' THEN 'S' WHEN 'P' THEN 'P' ELSE NULL END) AS prefix_pat_acct_num, vendor_cid AS pas_coid, financial_class, patient_type, NULL AS dw_last_update_date_time, b.source_system_code AS edi_837_type, NULL AS source_system_code, OperationalGroup FROM claimsconnectdb.dbo.fact_claim b WITH (nolock) LEFT JOIN claimsconnectdb.dbo.lu_billing_provider bp WITH (nolock) ON bp.bill_provider_npi = b.npi AND bp.billing_provider_sid = b.claim_id LEFT JOIN claimsconnectdb.dbo.dw_billing_provider stgb WITH (nolock) ON bp.bill_prov_provider_city = stgb.bill_prov_provider_city AND bp.bill_provider_addr1 = stgb.bill_provider_addr1 AND (stgb.bill_provider_addr2 = bp.bill_provider_addr2 OR (bp.bill_provider_addr2 IS NULL AND stgb.bill_provider_addr2 IS NULL)) AND bp.bill_provider_npi = stgb.bill_provider_npi AND bp.bill_provider_name = stgb.bill_provider_name AND bp.bill_provider_st = stgb.bill_provider_st AND bp.bill_provider_zip =stgb.bill_provider_zip AND stgb.bill_provider_npi = bp.bill_provider_npi LEFT JOIN claimsconnectdb.dbo.lu_pay_to_provider pp WITH (nolock) ON pp.provider_npi = b.npi AND pp.pay_to_provider_sid = b.claim_id LEFT JOIN claimsconnectdb.dbo.dw_pay_to_provider stgp WITH (nolock) ON pp.provider_city = stgp.provider_city AND pp.provider_addr1 = stgp.provider_addr1 AND (stgp.provider_addr2 = pp.provider_addr2 OR (pp.provider_addr2 IS NULL AND stgp.provider_addr2 IS NULL)) AND pp.provider_npi = stgp.provider_npi AND (pp.provider_name = stgp.provider_name OR (pp.provider_name IS NULL AND stgp.provider_name IS NULL)) AND pp.provider_st = stgp.provider_st AND pp.provider_zip =stgp.provider_zip AND stgp.provider_npi = pp.provider_npi~100000",
  "4~ClaimsConnectDB.dbo.Fact_Claim_Patient~v_clm_stage_dataset_name.fact_claim_patient~append~SELECT claim_id, patient_addr1, patient_addr2, patient_city, patient_dob, patient_first_name, patient_last_name, patient_sex AS patient_sex_cd, patient_st, patient_zip AS patient_zip_cd, resp_party_addr1, resp_party_addr2, resp_party_city, resp_party_name, resp_party_st, resp_party_zip AS resp_party_zip_cd, NULL AS dw_last_update_date_time, NULL AS source_system_code FROM claimsconnectdb.dbo.fact_claim_patient WITH (nolock)~100000",
  "5~ClaimsConnectDB.dbo.Fact_Claim_Insurance~v_clm_stage_dataset_name.fact_claim_insurance~append~SELECT claim_id, payor_seq_ind, id_plan AS iplan_id, payer_id, payer_sub_id, payer_name, health_plan_id, release_info_ind AS release_info_cert_desc, assign_benefit_ind AS assign_benefit_cert_desc, prior_pay_amt, est_due_amt, oth_provider_id AS other_provider_id, insured_name, pat_rel_to_ins_ind AS pat_to_ins_rel_ind, insured_id, insured_grp_name AS insured_group_name, insured_grp_num AS insured_group_num, treatment_auth_code, employer_name AS employer_name, doc_ctrl_num AS doc_cntrl_num, NULL AS dw_last_update_date_time, NULL AS source_system_code FROM claimsconnectdb.dbo.fact_claim_insurance ins WITH (nolock)~100000",
  "6~ClaimsConnectDB.dbo.Fact_Charge~v_clm_stage_dataset_name.fact_charge~append~SELECT CAST(claim_id AS VARCHAR(50)) AS claim_id, charge_seq_num, revenue_code AS charge_revenue_code, ndc_code AS charge_ndc_code, ndc_drug_qty AS charge_ndc_drug_qty, ndc_drug_uom AS charge_ndc_drug_uom, hcpcs AS charge_hcpcs, charge_rate AS charge_rate_value, hcpcs_modifier1 AS charge_hcpcs_modifier1_cd, hcpcs_modifier2 AS charge_hcpcs_modifier2_cd, hcpcs_modifier3 AS charge_hcpcs_modifier3_cd, hcpcs_modifier4 AS charge_hcpcs_modifier4_cd, service_dt AS charge_service_dt, units_of_service AS charge_unit_of_svc_num, total_amt AS charge_total_amt, CAST(non_covered_amt AS decimal(18, 3)) AS charge_non_covered_amt, NULL AS dw_last_update_date_time, NULL AS source_system_code FROM claimsconnectdb.dbo.fact_charge WITH (nolock)~100000",
  "7~ClaimsConnectDB.dbo.Fact_Code~v_clm_stage_dataset_name.fact_code~append~SELECT claim_id, code_seq_num, code_type_id, code_value, code_amt, CAST(code_from_dt AS DATE) AS code_from_dt, CAST(code_thru_dt AS DATE) AS code_thru_dt, (CASE WHEN code_poa_ind = 'Y' THEN 'Y' WHEN code_poa_ind = 'N' THEN 'N' WHEN code_poa_ind='U' THEN 'U' ELSE NULL END) AS code_poa_ind, NULL AS dw_last_update_date_time, NULL AS source_system_code FROM claimsconnectdb.dbo.fact_code WITH (nolock)~100000",
  "8~ClaimsConnectDB.dbo.Fact_Claim_Physician~v_clm_stage_dataset_name.fact_claim_physician~append~SELECT claim_id, phy_id AS phys_code, phy_first_name AS phys_first_name, phy_last_name AS phys_last_name, phy_qual_id AS phys_qual_code, phy_taxonomy_code AS phys_taxonomy_code, phy_type_id AS phys_type_code, NULL AS dw_last_update_date_time, NULL AS source_system_code FROM claimsconnectdb.dbo.fact_claim_physician WITH (nolock)~100000"
]

schedule:
  - schedule_interval: None
    start_date: pendulum.datetime(2025, 2, 1, tz=current_timezone)
    frequency: daily
    dag_name_suffix: core_claims
    done_file: Claims_YYYYMMDD.done
    has_sensor: 'No'
    trigger_dag_ids: ['dag_integrate_claims_sqlserver_daily_core_claims']
    tblist: [tblist1]
    truncatetablelist: ['v_clm_stage_dataset_name.lu_billing_provider', 'v_clm_stage_dataset_name.lu_pay_to_provider', 'v_clm_stage_dataset_name.fact_claim', 'v_clm_stage_dataset_name.fact_claim_patient','v_clm_stage_dataset_name.fact_claim_insurance', 'v_clm_stage_dataset_name.fact_charge', 'v_clm_stage_dataset_name.fact_code', 'v_clm_stage_dataset_name.fact_claim_physician']
