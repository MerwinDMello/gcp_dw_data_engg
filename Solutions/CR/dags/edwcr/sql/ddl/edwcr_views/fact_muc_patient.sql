-- Translation time: 2023-05-10T05:47:50.588331Z
-- Translation job ID: 92e92d81-1143-4781-91d8-614cfb5dfe89
-- Source: eim-ops-cs-datamig-dev-0002/sql_conversion/edwcr_migration_source/{{ params.param_cr_views_dataset_name }}/fact_muc_patient.sql
-- Translated from: Teradata
-- Translated to: BigQuery

CREATE OR REPLACE VIEW {{ params.param_cr_views_dataset_name }}.fact_muc_patient AS SELECT
    a.patient_dw_id,
    a.mu_population_sid,
    a.mu_facility_record_sid,
    a.national_provider_id,
    a.company_code,
    a.coid,
    a.pat_acct_num,
    a.medical_record_num,
    a.patient_market_urn,
    a.patient_full_name,
    a.admit_date_time,
    a.discharge_date,
    a.departure_date_time,
    a.discharge_date_time,
    a.discharge_disposition_code,
    a.billing_discharge_disp_code,
    a.date_of_birth,
    a.patient_age,
    a.date_of_death,
    a.cause_of_death_code,
    a.patient_accomodation_code,
    a.patient_location_code,
    a.patient_type_code_pos1,
    a.patient_ethnicity_type_code,
    a.patient_race_code,
    a.gender_code,
    a.smoking_status_id,
    a.snomed_smoking_code,
    a.primary_language_code,
    a.height_feet,
    a.height_inches,
    a.height_centimeters,
    a.weight_pounds,
    a.weight_ounces,
    a.weight_kilograms,
    a.calculated_bmi,
    a.calculated_bmi_metric,
    a.blood_pressure,
    a.diag_code,
    a.order_num,
    a.order_date,
    a.ordering_hcp_dw_id,
    a.rx_urn,
    a.med_order_sw,
    a.cpoe_med_order_sw,
    a.drug_allergy_desc,
    a.clinical_rec_sw,
    a.ccd_received_date_time,
    a.ccd_allergy_ind,
    a.ccd_problem_ind,
    a.ccd_medication_ind,
    a.problem_action_user_code,
    a.problem_action_date_time,
    a.med_action_user_code,
    a.med_action_date_time,
    a.allergy_action_user_code,
    a.allergy_action_date_time,
    a.medlist_rx_urn,
    a.medrec_rx_urn,
    a.med_rec_sw,
    a.med_status_code,
    a.problem_mnemonic,
    a.problem_urn,
    a.rx_action_text,
    a.rx_unit_text,
    a.rx_frequency_text,
    a.rx_dose_text,
    a.rx_route_mnem_cs,
    a.adv_dir_response_text,
    a.patient_note_sw,
    a.document_date_time,
    a.document_template_mnem_cs,
    a.document_status,
    a.electronic_signature_ind,
    a.signature_date_time,
    a.ehi_request_text,
    a.ehi_request_date_time,
    a.ehi_response_text,
    a.ehi_response_date_time,
    a.edi_request_text,
    a.edi_request_date_time,
    a.edi_response_text,
    a.edi_received_date_time,
    a.portal_available_sw,
    a.portal_available_action_code,
    a.portal_available_action_desc,
    a.portal_available_date_time,
    a.portal_utilized_sw,
    a.portal_user_id,
    a.portal_utilized_action_code,
    a.portal_utilized_action_desc,
    a.portal_utilized_date_time,
    a.secure_message_sw,
    a.secure_message_portal_user_id,
    a.secure_message_action_code,
    a.secure_message_action_desc,
    a.secure_message_date_time,
    a.api_sw,
    a.api_portal_user_id,
    a.api_action_code,
    a.api_action_desc,
    a.api_date_time,
    a.pat_gen_data_sw,
    a.pat_gen_data_portal_user_id,
    a.pat_gen_data_action_code,
    a.pat_gen_data_action_desc,
    a.pat_gen_data_date_time,
    a.hie_out_sw,
    a.hie_outb_service_sw,
    a.hie_outb_audit_date_time,
    a.hie_outb_message_num,
    a.hie_outb_acknowledge_code,
    a.hie_outb_error_type_code,
    a.hie_outb_unique_message_id,
    a.hie_outb_recipient_email_addr,
    a.hie_outb_delivery_status_desc,
    a.hie_outb_received_date_time,
    a.hie_outb_queue_date_time,
    a.hie_in_sw,
    a.hie_inb_aval_sw,
    a.hie_inb_mis_audit_num,
    a.hie_inb_received_date_time,
    a.hie_inb_queue_date_time,
    a.hie_inb_dbmotion_level_code,
    a.hie_inb_acknowledge_code,
    a.hie_inb_message_num,
    a.hie_inb_unique_message_id,
    a.hie_inb_sender_email_addr,
    a.hie_inb_delivery_status_desc,
    a.pat_ed_rxnorm_sw,
    a.pat_ed_med_action_desc,
    a.pat_ed_med_desc,
    a.pat_ed_rxnorm_code,
    a.pat_ed_problem_desc,
    a.pat_ed_snomed_code,
    a.pat_ed_available_date_time,
    a.pat_ed_med_rec_urn,
    a.pat_ed_query_response,
    a.pat_ed_prov_date_time,
    a.pat_ed_prov_sw,
    a.smry_care_prov_sw,
    a.smry_care_prov_code,
    a.smry_care_prov_desc,
    a.smry_care_prov_date_time,
    a.smry_care_eltr_prov_sw,
    a.smry_care_eltr_prov_code,
    a.smry_care_eltr_prov_desc,
    a.smry_care_eltr_prov_date_time,
    a.smry_care_eltr_prov_hisp_date_time,
    a.hisp_message_network_guid,
    a.smry_care_med_list_urn,
    a.smry_care_provider_group_code,
    a.smry_care_hcp_mnemonic_cs,
    a.smry_care_resource_code,
    a.family_problem_mnemonic_cs,
    a.no_family_history_ind,
    a.relative_urn,
    a.relationship_code,
    a.first_degree_relationship_desc,
    a.patient_email_addr,
    a.guarantor_email_addr,
    a.dw_last_update_date_time
  FROM
    {{ params.param_cr_base_views_dataset_name }}.fact_muc_patient AS a
    INNER JOIN {{ params.param_auth_base_views_dataset_name }}.cr_secref_facility AS b ON a.company_code = b.company_code
     AND a.coid = b.co_id
     AND b.user_id = session_user()
;
