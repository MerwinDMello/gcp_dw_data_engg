#source system specific configuration values

v_sourcesysnm: metriq
v_databasetype: sqlserver
v_cred_secret_name: cr_sql_metriq_credentials/versions/latest
v_jdbc_class_name: com.microsoft.sqlserver.jdbc.SQLServerDriver
v_jdbc_jar: mssql-jdbc-12.4.0.jre8.jar
v_jdkfile: jre-8u351-linux-x64.tar.gz
v_jdkversion: jre1.8.0_351
v_jdbcbqpytemplate: Jdbc_to_BigQuery_PythonTemplate.py
v_machine_type: n1-highmem-8

#srctablelist srctableid~srctablename~tgttablename~tgttableloadtype~srctablequery~rowcommitsize

#DAG_1
tblist1: [
  "1~mdictionary.dbo.siteconversiondetail~v_cr_stage_dataset_name.ref_icd_oncology_stg~append~select distinct t1.convertto as icd_oncology_code ,'3' as icd_oncology_type_code ,'t' as icd_oncology_category_type_cd ,case when t1.convertto between 'c340' and 'c349' then 'lung' when t1.convertto between 'c500' and 'c509' then 'breast' when t1.convertto between 'c310' and 'c319' then 'accessory sinus' when t1.convertto between 'c740' and 'c749' then 'adrenal gland' when t1.convertto between 'c470' and 'c479' then 'autonomic nervous ' when t1.convertto between 'c010' and 'c019' then 'base of tongue' when t1.convertto between 'c670' and 'c679' then 'bladder' when t1.convertto between 'c400' and 'c409' then 'bone limb' when t1.convertto between 'c410' and 'c419' then 'bone nos' when t1.convertto between 'c710' and 'c719' then 'brain' when t1.convertto between 'c530' and 'c539' then 'cervix uteri' when t1.convertto between 'c180' and 'c189' then 'colon' when t1.convertto between 'c540' and 'c549' then 'corpus uteri' when t1.convertto between 'c750' and 'c759' then 'endocrine gland nos' when t1.convertto between 'c690' and 'c699' then 'eye' when t1.convertto between 'c570' and 'c579' then 'female genital tract nos' when t1.convertto between 'c040' and 'c049' then 'floor of mouth' when t1.convertto between 'c230' and 'c239' then 'gallbladder' when t1.convertto between 'c240' and 'c249' then 'gi - biliary tract other' when t1.convertto between 'c250' and 'c259' then 'gi - pancreas' when t1.convertto between 'c210' and 'c218' then 'gi- anus' when t1.convertto between 'c150' and 'c159' then 'gi- esophagus' when t1.convertto between 'c260' and 'c269' then 'gi -other gi ' when t1.convertto between 'c190' and 'c199' then 'gi- rectosigmoid' when t1.convertto between 'c160' and 'c169' then 'gi- stomach' when t1.convertto between 'c220' and 'c220' then 'gi-liver' when t1.convertto between 'c200' and 'c209' then 'gi-rectum' when t1.convertto between 'c030' and 'c039' then 'gum ' when t1.convertto between 'c420' and 'c424' then 'hematopoietic system' when t1.convertto between 'c130' and 'c139' then 'hypopharynx' when t1.convertto between 'c140' and 'c148' then 'ill defined oral cavity' when t1.convertto between 'c760' and 'c768' then 'ill defined site' when t1.convertto between 'c640' and 'c649' then 'kidney' when t1.convertto between 'c320' and 'c329' then 'larynx' when t1.convertto between 'c000' and 'c009' then 'lip' when t1.convertto between 'c770' and 'c779' then 'lymph nodes' when t1.convertto between 'c080' and 'c089' then 'major salivary gland' when t1.convertto between 'c630' and 'c639' then 'male genital other' when t1.convertto between 'c700' and 'c709' then 'meninges' when t1.convertto between 'c300' and 'c300' then 'nasal cavity' when t1.convertto between 'c110' and 'c119' then 'nasopharynx' when t1.convertto between 'c720' and 'c729' then 'nervous system' when t1.convertto between 'c100' and 'c109' then 'oropharynx' when t1.convertto between 'c060' and 'c069' then 'other mouth' when t1.convertto between 'c020' and 'c029' then 'other tongue' when t1.convertto between 'c560' and 'c569' then 'ovary' when t1.convertto between 'c050' and 'c059' then 'palate' when t1.convertto between 'c070' and 'c079' then 'parotid' when t1.convertto between 'c600' and 'c609' then 'penis' when t1.convertto between 'c580' and 'c589' then 'placenta' when t1.convertto between 'c380' and 'c388' then 'pleura other' when t1.convertto between 'c610' and 'c619' then 'prostate ' when t1.convertto between 'c120' and 'c129' then 'pyriform sinus' when t1.convertto between 'c650' and 'c659' then 'renal pelvis' when t1.convertto between 'c390' and 'c399' then 'respiratory ill defined' when t1.convertto between 'c480' and 'c488' then 'retroperitoneum overlapping' when t1.convertto between 'c440' and 'c449' then 'skin' when t1.convertto between 'c170' and 'c179' then 'small intestine' when t1.convertto between 'c490' and 'c499' then 'soft tissue nos' when t1.convertto between 'c620' and 'c629' then 'testis' when t1.convertto between 'c370' and 'c379' then 'thymus' when t1.convertto between 'c730' and 'c739' then 'thyroid gland' when t1.convertto between 'c090' and 'c099' then 'tonsil' when t1.convertto between 'c330' and 'c339' then 'trachea' when t1.convertto between 'c800' and 'c809' then 'unknown primary site ' when t1.convertto between 'c660' and 'c669' then 'ureter' when t1.convertto between 'c680' and 'c689' then 'urinary system other' when t1.convertto between 'c550' and 'c559' then 'uterus nos' when t1.convertto between 'c520' and 'c529' then 'vagina' when t1.convertto between 'c510' and 'c519' then 'vulva' end as icd_oncology_site_desc, 'M' as source_system_code, 'v_currtimestamp' as dw_last_update_date_time from mdictionary.dbo.siteconversiondetail t1 (NOLOCK) where ( t1.convertto between 'c340' and 'c349' or t1.convertto between 'c500' and 'c509' or t1.convertto between 'c310' and 'c319' or t1.convertto between 'c740' and 'c749' or t1.convertto between 'c470' and 'c479' or t1.convertto between 'c010' and 'c019' or t1.convertto between 'c670' and 'c679' or t1.convertto between 'c400' and 'c409' or t1.convertto between 'c410' and 'c419' or t1.convertto between 'c710' and 'c719' or t1.convertto between 'c530' and 'c539' or t1.convertto between 'c180' and 'c189' or t1.convertto between 'c540' and 'c549' or t1.convertto between 'c750' and 'c759' or t1.convertto between 'c690' and 'c699' or t1.convertto between 'c570' and 'c579' or t1.convertto between 'c040' and 'c049' or t1.convertto between 'c230' and 'c239' or t1.convertto between 'c240' and 'c249' or t1.convertto between 'c250' and 'c259' or t1.convertto between 'c210' and 'c218' or t1.convertto between 'c150' and 'c159' or t1.convertto between 'c260' and 'c269' or t1.convertto between 'c190' and 'c199' or t1.convertto between 'c160' and 'c169' or t1.convertto between 'c220' and 'c220' or t1.convertto between 'c200' and 'c209' or t1.convertto between 'c030' and 'c039' or t1.convertto between 'c420' and 'c424' or t1.convertto between 'c130' and 'c139' or t1.convertto between 'c140' and 'c148' or t1.convertto between 'c760' and 'c768' or t1.convertto between 'c640' and 'c649' or t1.convertto between 'c320' and 'c329' or t1.convertto between 'c000' and 'c009' or t1.convertto between 'c770' and 'c779' or t1.convertto between 'c080' and 'c089' or t1.convertto between 'c630' and 'c639' or t1.convertto between 'c700' and 'c709' or t1.convertto between 'c300' and 'c300' or t1.convertto between 'c110' and 'c119' or t1.convertto between 'c720' and 'c729' or t1.convertto between 'c100' and 'c109' or t1.convertto between 'c060' and 'c069' or t1.convertto between 'c020' and 'c029' or t1.convertto between 'c560' and 'c569' or t1.convertto between 'c050' and 'c059' or t1.convertto between 'c070' and 'c079' or t1.convertto between 'c600' and 'c609' or t1.convertto between 'c580' and 'c589' or t1.convertto between 'c380' and 'c388' or t1.convertto between 'c610' and 'c619' or t1.convertto between 'c120' and 'c129' or t1.convertto between 'c650' and 'c659' or t1.convertto between 'c390' and 'c399' or t1.convertto between 'c480' and 'c488' or t1.convertto between 'c440' and 'c449' or t1.convertto between 'c170' and 'c179' or t1.convertto between 'c490' and 'c499' or t1.convertto between 'c620' and 'c629' or t1.convertto between 'c370' and 'c379' or t1.convertto between 'c730' and 'c739' or t1.convertto between 'c090' and 'c099' or t1.convertto between 'c330' and 'c339' or t1.convertto between 'c800' and 'c809' or t1.convertto between 'c660' and 'c669' or t1.convertto between 'c680' and 'c689' or t1.convertto between 'c550' and 'c559' or t1.convertto between 'c520' and 'c529' or t1.convertto between 'c510' and 'c519' )~100000",
  "2~mdictionary.dbo.siteconversiondetail~v_cr_stage_dataset_name.ref_icd_oncology_diag_cd_stg~append~select distinct t1.convertto as icd_oncology_code ,'3' as icd_oncology_type_code ,'t' as icd_oncology_category_type_cd ,t1.code as diagnosis_code ,case when t1.siteconversionid = 1 then '9' when t1.siteconversionid = 3 then '0' else '' end as diagnosis_type_code, 'M' as source_system_code, 'v_currtimestamp' as dw_last_update_date_time from mdictionary.dbo.siteconversiondetail t1 (NOLOCK) where ( t1.convertto between 'c340' and 'c349' or t1.convertto between 'c500' and 'c509' or t1.convertto between 'c310' and 'c319' or t1.convertto between 'c740' and 'c749' or t1.convertto between 'c470' and 'c479' or t1.convertto between 'c010' and 'c019' or t1.convertto between 'c670' and 'c679' or t1.convertto between 'c400' and 'c409' or t1.convertto between 'c410' and 'c419' or t1.convertto between 'c710' and 'c719' or t1.convertto between 'c530' and 'c539' or t1.convertto between 'c180' and 'c189' or t1.convertto between 'c540' and 'c549' or t1.convertto between 'c750' and 'c759' or t1.convertto between 'c690' and 'c699' or t1.convertto between 'c570' and 'c579' or t1.convertto between 'c040' and 'c049' or t1.convertto between 'c230' and 'c239' or t1.convertto between 'c240' and 'c249' or t1.convertto between 'c250' and 'c259' or t1.convertto between 'c210' and 'c218' or t1.convertto between 'c150' and 'c159' or t1.convertto between 'c260' and 'c269' or t1.convertto between 'c190' and 'c199' or t1.convertto between 'c160' and 'c169' or t1.convertto between 'c220' and 'c220' or t1.convertto between 'c200' and 'c209' or t1.convertto between 'c030' and 'c039' or t1.convertto between 'c420' and 'c424' or t1.convertto between 'c130' and 'c139' or t1.convertto between 'c140' and 'c148' or t1.convertto between 'c760' and 'c768' or t1.convertto between 'c640' and 'c649' or t1.convertto between 'c320' and 'c329' or t1.convertto between 'c000' and 'c009' or t1.convertto between 'c770' and 'c779' or t1.convertto between 'c080' and 'c089' or t1.convertto between 'c630' and 'c639' or t1.convertto between 'c700' and 'c709' or t1.convertto between 'c300' and 'c300' or t1.convertto between 'c110' and 'c119' or t1.convertto between 'c720' and 'c729' or t1.convertto between 'c100' and 'c109' or t1.convertto between 'c060' and 'c069' or t1.convertto between 'c020' and 'c029' or t1.convertto between 'c560' and 'c569' or t1.convertto between 'c050' and 'c059' or t1.convertto between 'c070' and 'c079' or t1.convertto between 'c600' and 'c609' or t1.convertto between 'c580' and 'c589' or t1.convertto between 'c380' and 'c388' or t1.convertto between 'c610' and 'c619' or t1.convertto between 'c120' and 'c129' or t1.convertto between 'c650' and 'c659' or t1.convertto between 'c390' and 'c399' or t1.convertto between 'c480' and 'c488' or t1.convertto between 'c440' and 'c449' or t1.convertto between 'c170' and 'c179' or t1.convertto between 'c490' and 'c499' or t1.convertto between 'c620' and 'c629' or t1.convertto between 'c370' and 'c379' or t1.convertto between 'c730' and 'c739' or t1.convertto between 'c090' and 'c099' or t1.convertto between 'c330' and 'c339' or t1.convertto between 'c800' and 'c809' or t1.convertto between 'c660' and 'c669' or t1.convertto between 'c680' and 'c689' or t1.convertto between 'c550' and 'c559' or t1.convertto between 'c520' and 'c529' or t1.convertto between 'c510' and 'c519' ) and t1.siteconversionid in (1,3)~100000"
]

tblist2: [
  "3~MDictionary.dbo.Security~v_cr_stage_dataset_name.cr_system_user_stg~append~select SecurityId,TRIM(UserId) AS UserId, TRIM(FirstName) AS FirstName,TRIM(LastName) AS LastName,'M' AS Source_System_Code,'v_currtimestamp' AS DW_Last_Update_Date_Time from MDictionary.dbo.Security (nolock)~100000"
]

#DAG_2
tblist3: [
  "4~mdictionary.dbo.lookupgroups~v_cr_stage_dataset_name.ref_lookup_groups_stg~append~select distinct groupid as group_id,lookupid as lookup_id,beginhisto as beginhisto,endhisto as endhisto,beginprimarysite as beginprimarysite,endprimarysite as endprimarysite,beginrxtype as beginrxtype,endrxtype as endrxtype,'v_currtimestamp' as dw_last_update_date_time from mdictionary.dbo.lookupgroups (nolock) where lookupid = '4043'~100000"
]

tblist4: [
  "5~mregistry.dbo.tumorext1a,mdictionary.dbo.statecodes,mregistry.dbo.tumor~v_cr_stage_dataset_name.ref_lookup_code_stg~append~SELECT coalesce(999914,'') as Lookup_Id, null as Group_Id, '0' as Lookup_Code, null as Lookup_Sub_Code, trim(txtpaysource) as Lookup_Desc, null as ID, null as LookUp_Name, 'M' AS Source_System_Code,'v_currtimestamp' AS DW_Last_Update_Date_Time from mregistry.dbo.tumorext1a (nolock) GROUP BY  trim(txtpaysource) UNION ALL  SELECT coalesce(999923,'') as Lookup_Id, null as Group_Id, StateAbbrev as Lookup_Code, null as Lookup_Sub_Code, StateName as Lookup_Desc, null as ID, null as LookUp_Name, 'M' AS Source_System_Code,'v_currtimestamp' AS DW_Last_Update_Date_Time FROM ( select StateAbbrev, StateName, ROW_NUMBER() over(partition by StateAbbrev ORDER BY CountryID DESC) as Cnt from MDictionary.dbo.StateCodes) P WHERE Cnt = 1 UNION ALL Select distinct coalesce(999946,'') as Lookup_Id, null as Group_Id, t02.BestCSTNMStage as Lookup_Code, null as Lookup_Sub_Code, CASE WHEN T02.BestCSTNMStage like '0%' THEN 'Stage 0'  WHEN T02.BestCSTNMStage like '1%' THEN 'Stage 1' WHEN T02.BestCSTNMStage like '2%' THEN 'Stage 2' WHEN T02.BestCSTNMStage like '3%' THEN 'Stage 3' WHEN T02.BestCSTNMStage like '4%' THEN 'Stage 4' END as Lookup_Desc,null as ID, null as LookUp_Name, 'M' AS Source_System_Code,'v_currtimestamp' AS DW_Last_Update_Date_Time FROM Mregistry.dbo.Tumor t02 (nolock) WHERE SUBSTRING(T02.BestCSTNMStage,1,1) IN ('1','2','3','4')~100000",
  "6~mdictionary.dbo.lookupids, mdictionary.dbo.udflookupcodes~v_cr_stage_dataset_name.ref_lookup_code_stg~append~SELECT lc.lookupid AS Lookup_Id, lc.groupid AS Group_Id, lc.code AS Lookup_Code, lc.subcode AS Lookup_Sub_Code, REPLACE( REPLACE( REPLACE(TRIM(lc.description), NCHAR(26), NCHAR(45)), NCHAR(8211), NCHAR(45)), NCHAR(8217), NCHAR(34)) as Lookup_Desc, lc.id as ID, li.lookupname as LookUp_Name, 'M' as source_system_code, 'v_currtimestamp' as dw_last_update_date_time from mdictionary.dbo.lookupcodes lc left join  mdictionary .dbo.lookupids li on lc.lookupid = li.lookupid union all select ulc.lookupid as Lookup_Id, 0 as Group_Id, ulc.code as Lookup_Code, ulc.subcode as Lookup_Sub_Code, TRIM(ulc.description) as Lookup_Desc, ulc.id as ID, 'udf_code' as LookUp_Name, 'M' as source_system_code, 'v_currtimestamp' as dw_last_update_date_time from mdictionary.dbo.udflookupcodes ulc (nolock)~100000"
]

tblist5: [
  "7~mdictionary.dbo.Treatment~v_cr_stage_dataset_name.ref_treatment_type_group_stg~append~select  distinct case when rxtype = 'd' then 'biopsy'  when rxtype = 's' then 'surgery'  when rxtype = 'r' then 'rad onc'  when rxtype = 'c' then 'med onc'  when rxtype = 'h' then 'med onc'  when rxtype = 'i' then 'med onc'  when rxtype = 't' then 'med onc'  when rxtype = 'o' then 'other'  when rxtype = 'p' then 'other'  else 'null' end as 'nav_treatment_type_group_desc', rxtype as 'treatment_type_group_code', case when rxtype = 'd' then 'surgical diagnostic/staging procedure (biopsy)'  when rxtype = 's' then 'surgery'  when rxtype = 'r' then 'radiation'  when rxtype = 'c' then 'chemotherapy'  when rxtype = 'h' then 'hormone therapy'  when rxtype = 'i' then 'immunotherapy'  when rxtype = 't' then 'hematologic transplant and endocrine procedures'  when rxtype = 'o' then 'other treatment'  when rxtype = 'p' then 'palliative care'  else 'null' end as 'treatment_type_group_desc' ,'M' as source_system_code ,'v_currtimestamp' as dw_last_update_date_time from mregistry.dbo.treatment (nolock) where rxtype in ('d','s','r','c','h','i','t','o','p')~100000",
  "8~mregistry.dbo.treatment,mregistry.dbo.drug,mregistry.dbo.radiation~v_cr_stage_dataset_name.ref_hospital_stg~append~select row_number() over(order by hospital_code1 asc ) as hospital_id,trim(hospital_code1) as hospital_code,trim(hospital_name) as hospital_name, 'M' as source_system_code, 'v_currtimestamp' as dw_last_update_date_time from (select distinct case when facility is null or facility ='' then cast(-99 as char(10)) else hospital_code end as hospital_code1, case when facility is null or facility ='' then 'Unknown Hospital' else facility end as hospital_name from (select distinct treatmenthospid as hospital_code, case when t2.facilityid is null then t4.fname else t2.fname end as facility from mregistry.dbo.treatment t1 (nolock) left join mdictionary.dbo.facilities t2 on t1.treatmenthospid = t2.nodbclientid left join mdictionary.dbo.globalparameters t3 on t1.treatmenthospid = t3.fin left join mdictionary.dbo.facilities t4 on t3.facilityid = t4.facilityid union select distinct drughospid as hospital_code,case when t2.facilityid is null then t4.fname else t2.fname end as facility from mregistry.dbo.drug t1 (nolock) left join mdictionary.dbo.facilities t2 on t1.drughospid = t2.nodbclientid left join mdictionary.dbo.globalparameters t3 on t1.drughospid = t3.fin left join mdictionary.dbo.facilities t4 on t3.facilityid = t4.facilityid union select distinct radiationhospid as hospital_code,case when t2.facilityid is null then t4.fname else t2.fname end as facility from mregistry.dbo.radiation t1 (nolock) left join mdictionary.dbo.facilities t2 on t1.radiationhospid = t2.nodbclientid left join mdictionary.dbo.globalparameters t3 on t1.radiationhospid = t3.fin left join mdictionary.dbo.facilities t4 on t3.facilityid = t4.facilityid)a ) b~100000",
  "9~mdictionary.dbo.Patient~v_cr_stage_dataset_name.ref_cr_treatment_type_stg~append~SELECT  distinct TRIM(Treatment.RxCode) as Treatment_Type_Code , TRIM(L2371.Description) as Treatment_Type_Desc ,L2371.GroupID as Treatment_Group_Id ,'M' AS Source_System_Code ,'v_currtimestamp' AS DW_Last_Update_Date_Time FROM MRegistry.dbo.Patient (nolock) INNER JOIN MRegistry.dbo.TumorExt1a on TumorExt1a.PatientID = Patient.PatientID LEFT OUTER JOIN MRegistry.dbo.Treatment on Treatment.TumorID = TumorExt1a.TumorID LEFT OUTER JOIN MDictionary.dbo.LookupCodes as L2371 ON L2371.LookupID = 4043 AND L2371.Code = Treatment.RxCode  AND L2371.SubCode = Treatment.rxsubcode INNER JOIN  ( SELECT  PatientID ,t1.TumorID ,t2.TreatmentID ,MAX (t3.groupID) as GroupID  FROM MRegistry.dbo.Tumor t1 (nolock) LEFT JOIN MRegistry.dbo.Treatment t2  ON t1.TumorID = t2.TumorID  INNER JOIN  MDictionary.dbo.LookupGroups t3  ON  t3.beginhisto <= left(t1.histology,4)  AND t3.endhisto >= left(t1.histology,4)  AND t3.beginprimarysite <= CASE RIGHT(t1.primarysite, 3) WHEN '***' THEN '000' ELSE RIGHT(t1.primarysite, 3) END  AND t3.endprimarysite >= CASE RIGHT(t1.primarysite, 3) WHEN '***' THEN '000' ELSE RIGHT(t1.primarysite, 3) END AND t3.beginrxtype <= CASE t2.rxtype WHEN 'D' THEN '0' WHEN 'P' THEN '1' WHEN 'S' THEN '2' WHEN 'R' THEN '3' WHEN 'C' THEN '4' WHEN 'H' THEN '5' WHEN 'I' THEN '6' WHEN 'T' THEN '7' WHEN 'O' THEN '8' END  AND t3.endrxtype >= CASE t2.rxtype WHEN 'D' THEN '0' WHEN 'P' THEN '1' WHEN 'S' THEN '2' WHEN 'R' THEN '3' WHEN 'C' THEN '4' WHEN 'H' THEN '5' WHEN 'I' THEN '6' WHEN 'T' THEN '7' WHEN 'O' THEN '8' END  AND t3.LookupID = 4043  GROUP BY  PatientID ,t1.TumorID ,t2.TreatmentID)SQ1  ON SQ1.GroupID = L2371.GroupID  and Treatment.TreatmentID = SQ1.TreatmentID~100000",
  "10~mdictionary.dbo.lookupcodes_nsc~v_cr_stage_dataset_name.ref_national_svc_center_stg~append~select coalesce(id,'') as id,coalesce(code,'') as code,coalesce(subcode,'') as subcode,coalesce(TRIM(description),'') as description,coalesce(TRIM(category),'') as category,coalesce(TRIM(subcategory),'') as subcategory,'v_currtimestamp' as dw_last_update_date_time from  mdictionary.dbo.lookupcodes_nsc (nolock)~100000"
]

tblist6: [
  "11~MRegistry.dbo.Drug~v_cr_stage_dataset_name.cr_patient_medical_oncology_stg~append~Select  Cycle_Id, Treatment_Id, Drug_Route_Id, Drug_Dose_Unit_Id, Drug_Id, Drug_Days_Given_Num_Text, Drug_Frequency_Num, Total_Drug_Dose_Amt, Drug_Hospital_Id, NSC_Id, CASE WHEN StartYear IS NOT NULL AND StartMonth IS NOT NULL AND StartDay IS NOT NULL AND ISDATE(CONCAT(StartYear, '-', StartMonth, '-', StartDay)) IS NOT NULL and TRY_CONVERT(DATE, CONCAT(StartYear, '-', StartMonth, '-', StartDay)) <= GETDATE() THEN CAST(CONCAT(StartYear, '-', StartMonth, '-', StartDay) AS date) ELSE NULL END AS Treatment_Start_Date, CASE WHEN (EndYear IS NOT NULL AND EndMonth IS NOT NULL AND EndDay IS NOT NULL) AND TRY_CONVERT(DATE, CONCAT(EndYear, '-', EndMonth, '-', EndDay)) IS NOT NULL AND TRY_CONVERT(DATE, CONCAT(EndYear, '-', EndMonth, '-', EndDay)) <= GETDATE() THEN TRY_CONVERT(DATE, CONCAT(EndYear, '-', EndMonth, '-', EndDay)) ELSE NULL END AS Treatment_End_Date, Cycle_Num_Text, NSC_SubCode, 'M' AS Source_System_Code, 'v_currtimestamp' AS DW_Last_Update_Date_Time from ( select  d.CycleID as Cycle_Id, c.TreatmentID as Treatment_Id, ltrim(rtrim(d.DrugRoute)) as Drug_Route_Id, ltrim(rtrim(d.DoseUnits)) as Drug_Dose_Unit_Id, d.DrugId as Drug_Id, ltrim(rtrim(d.DaysGiven)) as Drug_Days_Given_Num_Text, d.DailyDose as Drug_Frequency_Num, d.TotDosage as Total_Drug_Dose_Amt, ltrim(rtrim(d.DrugHospID)) as Drug_Hospital_Id, ltrim(rtrim(d.NSC)) as NSC_Id, ltrim(rtrim(c.CycleNum)) as Cycle_Num_Text, ltrim(rtrim(d.NSC_SubCode)) as NSC_SubCode, CASE  WHEN LEN(RTRIM(CONVERT(numeric, DtCycleStrt))) = 8 THEN  CASE  WHEN SUBSTRING(RTRIM(CONVERT(numeric, DtCycleStrt)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, DtCycleStrt)), 5, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, DtCycleStrt)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, DtCycleStrt)), 5, 2) END ELSE NULL END AS StartMonth,  CASE  WHEN LEN(RTRIM(CONVERT(numeric, DtCycleStrt))) = 8 THEN  CASE  WHEN SUBSTRING(RTRIM(CONVERT(numeric, DtCycleStrt)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, DtCycleStrt)), 7, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, DtCycleStrt)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, DtCycleStrt)), 7, 2) END ELSE NULL END AS StartDay, CASE  WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, DtCycleStrt)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric,DtCycleStrt))), 1, 4) ELSE NULL END AS StartYear, CASE  WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, CER_DrugEndDate)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, CER_DrugEndDate))), 1, 4) ELSE NULL END AS EndYear, CASE  WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, CER_DrugEndDate)))) = 8 THEN  CASE  WHEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, CER_DrugEndDate))), 5, 2) = '99'  OR SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, CER_DrugEndDate))), 5, 2) = '00' THEN '01' WHEN CAST(SUBSTRING(LTRIM(RTRIM(CONVERT(numeric,CER_DrugEndDate))), 5, 2) AS int) > 12 THEN NULL ELSE SUBSTRING(LTRIM(RTRIM(CONVERT(numeric,CER_DrugEndDate))), 5, 2) END ELSE NULL END AS EndMonth, CASE  WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, CER_DrugEndDate)))) = 8 THEN  CASE  WHEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, CER_DrugEndDate))), 7, 2) = '99'  OR SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, CER_DrugEndDate))), 7, 2) = '00' THEN '01' WHEN CAST(SUBSTRING(LTRIM(RTRIM(CONVERT(numeric,CER_DrugEndDate))), 7, 2) AS int) > 31 THEN NULL ELSE SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, CER_DrugEndDate))), 7, 2) END ELSE NULL END AS EndDay, row_number() over(partition by d.DrugId order by c.DtCycleStrt desc) rn from MRegistry.dbo.Drug d (nolock) Left Join mRegistry.dbo.Cycle c on d.CycleId = c.CycleId ) a where a.rn=1~100000",
  "12~mregistry.dbo.systemproductivitylog~v_cr_stage_dataset_name.cr_system_productivity_log_stg~append~select coalesce(systemproductivitylogid,'') as system_productivity_log_id,patientid as cr_patient_id,tumorid as tumor_id,userid as system_user_id_code,statusdate as system_change_status_date,'M' as source_system_code, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.systemproductivitylog (nolock)~100000"
]

tblist7: [
  "13~mregistry.dbo.radiation~v_cr_stage_dataset_name.cr_patient_radiation_oncology_stg~append~SELECT  RadiationID as Radiation_Id,  TreatmentID as Treatment_Id,  RT_Modality as Radiation_Type_Id,  RadiationHospID as Radiation_Hospital_Id,  CASE WHEN TRY_CONVERT(DATE, CONVERT(CHAR(8), CASE WHEN LEN(DtRT_Start) < 8 THEN NULL ELSE (DtRT_Start / 10000) * 10000 + CASE WHEN SUBSTRING(CAST(DtRT_Start AS CHAR(8)), 5, 2) IN ('99','00') THEN 1 ELSE SUBSTRING(CAST(DtRT_Start AS CHAR(8)), 5, 2) END * 100 + CASE WHEN DtRT_Start % 100 IN (99,0) THEN 1 ELSE DtRT_Start % 100 END END)) > GETDATE() THEN NULL ELSE TRY_CONVERT(DATE, CONVERT(CHAR(8), CASE WHEN LEN(DtRT_Start) < 8 THEN NULL ELSE (DtRT_Start / 10000) * 10000 + CASE WHEN SUBSTRING(CAST(DtRT_Start AS CHAR(8)), 5, 2) IN ('99','00') THEN 1 ELSE SUBSTRING(CAST(DtRT_Start AS CHAR(8)), 5, 2) END * 100 + CASE WHEN DtRT_Start % 100 IN (99,0) THEN 1 ELSE DtRT_Start % 100 END END)) END as Radiation_Treatment_Start_Date, CASE WHEN TRY_CONVERT(DATE, CONVERT(CHAR(8), CASE WHEN LEN(DtRT_Stop) < 8 THEN NULL ELSE (DtRT_Stop / 10000) * 10000 + CASE WHEN SUBSTRING(CAST(DtRT_Stop AS CHAR(8)), 5, 2) IN ('99','00') THEN 1 ELSE SUBSTRING(CAST(DtRT_Stop AS CHAR(8)), 5, 2) END * 100 + CASE WHEN DtRT_Stop % 100 IN (99,0) THEN 1 ELSE DtRT_Stop % 100 END END)) > GETDATE() THEN NULL ELSE TRY_CONVERT(DATE, CONVERT(CHAR(8), CASE WHEN LEN(DtRT_Stop) < 8 THEN NULL ELSE (DtRT_Stop / 10000) * 10000 + CASE WHEN SUBSTRING(CAST(DtRT_Stop AS CHAR(8)), 5, 2) IN ('99','00') THEN 1 ELSE SUBSTRING(CAST(DtRT_Stop AS CHAR(8)), 5, 2) END * 100 + CASE WHEN DtRT_Stop % 100 IN (99,0) THEN 1 ELSE DtRT_Stop % 100 END END)) END as Radiation_Treatment_End_Date, 'M' as Source_System_Code, 'v_currtimestamp' as DW_Last_Update_Date_Time  FROM MRegistry.dbo.radiation (nolock)~250000"
]

tblist8: [
  "14~mregistry.dbo.patient~v_cr_stage_dataset_name.cr_patient_address_stg~append~select patientid as cr_patient_id, trim(address1) as address_line_1_text, trim(address2) as address_line_2_text, trim(city) as city_name, state as state_id, TRIM(postalcode) as zip_code,'M' as source_system_code, 'v_currtimestamp' as dw_last_update_date_time from mregistry.dbo.patient (nolock)~250000"
]

tblist9: [
  "15~mregistry.dbo.Patient~v_cr_stage_dataset_name.cr_patient_stg~append~select FacilityID, PatientId, Sex, Race1, VitalStatus, PatientSystemId, COID, CASE WHEN YEAR IS NOT NULL AND MONTH IS NOT NULL AND DAY IS NOT NULL  AND TRY_CONVERT(DATE, YEAR + '-' + MONTH + '-' + DAY) IS NOT NULL AND TRY_CONVERT(DATE, YEAR + '-' + MONTH + '-' + DAY) <= GETDATE() THEN TRY_CONVERT(DATE, YEAR + '-' + MONTH + '-' + DAY)  ELSE NULL  END AS BirthDate, CASE WHEN YEAR1 IS NOT NULL AND MONTH1 IS NOT NULL AND DAY1 IS NOT NULL AND TRY_CONVERT(DATE, YEAR1 + '-' + MONTH1 + '-' + DAY1) IS NOT NULL        AND TRY_CONVERT(DATE, YEAR1 + '-' + MONTH1 + '-' + DAY1) <= GETDATE() THEN TRY_CONVERT(DATE, YEAR1 + '-' + MONTH1 + '-' + DAY1)  ELSE NULL END AS DateLastContact, TRIM(FirstName) AS FirstName, TRIM(MiddleName) AS MiddleName, TRIM(LastName) AS LastName, TRIM(PatEmail) AS PatEmail, AccessionNo, PtUDF90, TRIM(MedRecNo) AS MedRecNo, 'M' AS Source_System_Code, 'v_currtimestamp' AS DW_Last_Update_Date_Time from (SELECT DISTINCT Pat.FacilityID, Pat.PatientId, Pat.Sex, Pat.Race1, Pat.VitalStatus, Pat.PatientSystemId, COALESCE(ISNULL(Ref.COID,-1),'') AS COID, Pat.FirstName, Pat.MiddleName, Pat.LastName, Pat.PatEmail, Ext1.AccessionNo, Ext2.PtUDF90, Pat.MedRecNo, CASE   WHEN LEN(CONVERT(VARCHAR, BirthDate)) = 8 THEN CASE  WHEN SUBSTRING(CONVERT(VARCHAR, BirthDate), 7, 2) IN ('99', '00') THEN '01'  WHEN TRY_CONVERT(INT, SUBSTRING(CONVERT(VARCHAR, BirthDate), 7, 2)) > 31 THEN NULL  ELSE SUBSTRING(CONVERT(VARCHAR, BirthDate), 7, 2) END ELSE NULL  END AS DAY, CASE WHEN LEN(CONVERT(VARCHAR, DateLastContact)) = 8 THEN  CASE WHEN SUBSTRING(CONVERT(VARCHAR, DateLastContact), 7, 2) IN ('99', '00') THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(CONVERT(VARCHAR, DateLastContact), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(CONVERT(VARCHAR, DateLastContact), 7, 2) END  ELSE NULL  END AS DAY1,  CASE  WHEN LEN(CONVERT(VARCHAR, BirthDate)) = 8 THEN   CASE  WHEN SUBSTRING(CONVERT(VARCHAR, BirthDate), 5, 2) IN ('99', '00') THEN '01'  WHEN TRY_CONVERT(INT, SUBSTRING(CONVERT(VARCHAR, BirthDate), 5, 2)) > 12 THEN NULL  ELSE SUBSTRING(CONVERT(VARCHAR, BirthDate), 5, 2) END  ELSE NULL  END AS MONTH, CASE WHEN LEN(CONVERT(VARCHAR, DateLastContact)) = 8 THEN  CASE   WHEN SUBSTRING(CONVERT(VARCHAR, DateLastContact), 5, 2) IN ('99', '00') THEN '01'  WHEN TRY_CONVERT(INT, SUBSTRING(CONVERT(VARCHAR, DateLastContact), 5, 2)) > 12 THEN NULL  ELSE SUBSTRING(CONVERT(VARCHAR, DateLastContact), 5, 2) END ELSE NULL END AS MONTH1, CASE  WHEN LEN(CONVERT(VARCHAR, BirthDate)) = 8 THEN SUBSTRING(CONVERT(VARCHAR, BirthDate), 1, 4) ELSE NULL END AS YEAR, CASE  WHEN LEN(CONVERT(VARCHAR, DateLastContact)) = 8 THEN SUBSTRING(CONVERT(VARCHAR, DateLastContact), 1, 4) ELSE NULL END AS YEAR1 FROM  mregistry.dbo.Patient Pat (nolock) LEFT OUTER JOIN mdictionary.dbo.facilities_ref Ref ON Pat.FacilityID = Ref.FacilityID  LEFT OUTER JOIN mregistry.dbo.PatientExt1 Ext1 ON Pat.PatientId = Ext1.PatientId LEFT OUTER JOIN mregistry.dbo.PatientExt2 Ext2 ON Pat.PatientId = Ext2.PatientId ) mm~250000"
]

tblist10: [
  "16~mdictionary.dbo.Tumor~v_cr_stage_dataset_name.cr_patient_history_stg~append~select tumor.patientid as patientid,tumor.tumorid as tumorid,tumorext13.smokhist as smokhist,TRIM(tumorext13.amounttobacco) as amounttobacco,TRIM(tumorext13.yrstobacco1) as yrstobacco1,tumorext13.famhxca as famhxca,tumorext13.pthxca as pthxca,'M' as source_system_code,'v_currtimestamp' as dw_last_update_date_time from mregistry.dbo.tumor tumor (nolock) left outer join mregistry.dbo.tumorext13 tumorext13 on tumor.tumorid=tumorext13.tumorid~250000"
]

tblist11: [
  "17~mregistry.dbo.Tumor~v_cr_stage_dataset_name.cr_pat_tumor_pathology_result_stg~append~select tumor.patientid as patientid,tumor.tumorid as tumorid,tumorext1a.nodesexamined as nodesexamined,tumorext1a.nodespositive as nodespositive,'M' as source_system_code,'v_currtimestamp' as dw_last_update_date_time from mregistry.dbo.tumor tumor (nolock) left outer join mregistry.dbo.tumorext1a tumorext1a on tumor.tumorid=tumorext1a.tumorid~250000"
]

tblist12: [
  "18~mregistry.dbo.tumor~v_cr_stage_dataset_name.cr_patient_diagnosis_detail_stg~append~SELECT  Tumor_Id, HistoSubCode, CR_Patient_Id, Laterality, Histology, Diagnose_Age_Num,  First_Diagnose_Year_Num, CASE  WHEN (YEAR IS NOT NULL AND MONTH IS NOT NULL AND DAY IS NOT NULL) AND  TRY_CONVERT(DATE, CONCAT(YEAR, '-', MONTH, '-', DAY)) IS NOT NULL AND  TRY_CONVERT(DATE, CONCAT(YEAR, '-', MONTH, '-', DAY)) <= CAST(GETDATE() AS DATE) THEN TRY_CONVERT(DATE, CONCAT(YEAR, '-', MONTH, '-', DAY))  ELSE NULL  END AS Diagnosis_Date, 'M' AS Source_System_Code, 'v_currtimestamp' AS DW_Last_Update_Date_Time from ( select Tumor.TumorId AS Tumor_Id, Tumor.HistoSubCode AS HistoSubCode, Tumor.PatientId AS CR_Patient_Id, Tumor.Laterality AS Laterality, Tumor.Histology AS Histology, TumorExt1a.DxAge as Diagnose_Age_Num,  TumorExt1a.YearFirstCA as First_Diagnose_Year_Num, CASE  WHEN LEN(LTRIM(RTRIM(CAST(Tumor.DateDx AS VARCHAR(MAX))))) = 8 THEN  SUBSTRING(CAST(Tumor.DateDx AS VARCHAR(MAX)), 1, 4) ELSE  NULL END AS YEAR, CASE  WHEN LEN(LTRIM(RTRIM(CAST(Tumor.DateDx AS VARCHAR(MAX))))) = 8 THEN  CASE  WHEN SUBSTRING(LTRIM(RTRIM(CAST(Tumor.DateDx AS VARCHAR(MAX)))), 5, 2) IN ('99', '00') THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(LTRIM(RTRIM(CAST(Tumor.DateDx AS VARCHAR(MAX)))), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(LTRIM(RTRIM(CAST(Tumor.DateDx AS VARCHAR(MAX)))), 5, 2) END ELSE  NULL END AS MONTH, CASE  WHEN LEN(LTRIM(RTRIM(CAST(Tumor.DateDx AS VARCHAR(MAX))))) = 8 THEN  CASE  WHEN SUBSTRING(LTRIM(RTRIM(CAST(Tumor.DateDx AS VARCHAR(MAX)))), 7, 2) IN ('99', '00') THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(LTRIM(RTRIM(CAST(Tumor.DateDx AS VARCHAR(MAX)))), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(LTRIM(RTRIM(CAST(Tumor.DateDx AS VARCHAR(MAX)))), 7, 2) END ELSE  NULL END AS DAY  FROM  mRegistry.dbo.Tumor Tumor (nolock) LEFT OUTER JOIN  mRegistry.dbo.TumorExt1a TumorExt1a  ON Tumor.TumorId = TumorExt1a.TumorId ) mm~250000"
]

tblist13: [
  "19~mregistry.dbo.TumorExt1a~v_cr_stage_dataset_name.cr_patient_insurance_stg~append~select tumorid as tumor_id,patientid as patient_id,primpayerdx as primpayerdx,txtpaysource as txtpaysource,'M' as source_system_code,'v_currtimestamp' as dw_last_update_date_time from mregistry.dbo.tumorext1a (nolock)~250000"
]

tblist14: [
  "20~mregistry.dbo.tumor~v_cr_stage_dataset_name.cr_patient_tumor_stg~append~SELECT TumorId, PatientId, Grade, CaseStatFlag, PrimarySite, Primsitesubcode, MstDefChemoSumm, MstDefDxStageSumm, MstDefHormSumm, MstDefImmunoSumm, MstDefMarginsSumm, MstDefPallSumm, MstDefRTBoost, MstDefRTHosp, MstDefRTLoc, ReasonNoChemo, ReasonNoHormone, ReasonNoImmuno, ReasonNoRad, MstDefSurgPrimSumm, CS_SS_Factor_1_Num_Code, CS_SS_Factor_2_Num_Code, CS_SS_Factor_15_Num_Code, CS_SS_Factor_16_Num_Code, CS_SS_Factor_22_Num_Code, CS_SS_Factor_23_Num_Code, CS_SS_FACTOR_25_NUM_CODE, ChemoSrgSeq, MstDefRTMod, MstDefRTVol, MstDefScopeLNSumm, SurgAppHosp, MstDefSurgPrimHosp, CS_TumSize, CASE WHEN YEAR_MstDefChemoDt IS NOT NULL AND MONTH_MstDefChemoDt IS NOT NULL AND DAY_MstDefChemoDt IS NOT NULL AND ISDATE(CONCAT(YEAR_MstDefChemoDt, '-', MONTH_MstDefChemoDt, '-', DAY_MstDefChemoDt)) IS NOT NULL AND TRY_CONVERT(DATE, CONCAT(YEAR_MstDefChemoDt, '-', MONTH_MstDefChemoDt, '-', DAY_MstDefChemoDt)) <= GETDATE() THEN CAST(CONCAT(YEAR_MstDefChemoDt, '-', MONTH_MstDefChemoDt, '-', DAY_MstDefChemoDt) AS DATE) ELSE NULL END AS MstDefChemoDt, CASE WHEN YEAR_MstDefRTDt IS NOT NULL AND MONTH_MstDefRTDt IS NOT NULL AND DAY_MstDefRTDt IS NOT NULL AND ISDATE(CONCAT(YEAR_MstDefRTDt, '-', MONTH_MstDefRTDt, '-', DAY_MstDefRTDt)) IS NOT NULL AND TRY_CONVERT(DATE, CONCAT(YEAR_MstDefRTDt, '-', MONTH_MstDefRTDt, '-', DAY_MstDefRTDt)) <= GETDATE() THEN CAST(CONCAT(YEAR_MstDefRTDt, '-', MONTH_MstDefRTDt, '-', DAY_MstDefRTDt) AS DATE) ELSE NULL END AS MstDefRTDt, CASE WHEN YEAR_MstDefImmunoDt IS NOT NULL AND MONTH_MstDefImmunoDt IS NOT NULL AND DAY_MstDefImmunoDt IS NOT NULL AND ISDATE(CONCAT(YEAR_MstDefImmunoDt, '-', MONTH_MstDefImmunoDt, '-', DAY_MstDefImmunoDt)) IS NOT NULL AND TRY_CONVERT(DATE, CONCAT(YEAR_MstDefImmunoDt, '-', MONTH_MstDefImmunoDt, '-', DAY_MstDefImmunoDt)) <= GETDATE() THEN CAST(CONCAT(YEAR_MstDefImmunoDt, '-', MONTH_MstDefImmunoDt, '-', DAY_MstDefImmunoDt) AS DATE) ELSE NULL END AS MstDefImmunoDt, CASE WHEN YEAR_MstDefHormDt IS NOT NULL AND MONTH_MstDefHormDt IS NOT NULL AND DAY_MstDefHormDt IS NOT NULL AND ISDATE(CONCAT(YEAR_MstDefHormDt, '-', MONTH_MstDefHormDt, '-', DAY_MstDefHormDt)) IS NOT NULL AND TRY_CONVERT(DATE, CONCAT(YEAR_MstDefHormDt, '-', MONTH_MstDefHormDt, '-', DAY_MstDefHormDt)) <= GETDATE() THEN CAST(CONCAT(YEAR_MstDefHormDt, '-', MONTH_MstDefHormDt, '-', DAY_MstDefHormDt) AS DATE) ELSE NULL END AS MstDefHormDt, CASE WHEN YEAR_MstDefRTStopDt IS NOT NULL AND MONTH_MstDefRTStopDt IS NOT NULL AND DAY_MstDefRTStopDt IS NOT NULL AND ISDATE(CONCAT(YEAR_MstDefRTStopDt, '-', MONTH_MstDefRTStopDt, '-', DAY_MstDefRTStopDt)) IS NOT NULL AND TRY_CONVERT(DATE, CONCAT(YEAR_MstDefRTStopDt, '-', MONTH_MstDefRTStopDt, '-', DAY_MstDefRTStopDt)) <= GETDATE() THEN CAST(CONCAT(YEAR_MstDefRTStopDt, '-', MONTH_MstDefRTStopDt, '-', DAY_MstDefRTStopDt) AS DATE) ELSE NULL END AS MstDefRTStopDt, CASE WHEN YEAR_DtFirstSurg IS NOT NULL AND MONTH_DtFirstSurg IS NOT NULL AND DAY_DtFirstSurg IS NOT NULL AND ISDATE(CONCAT(YEAR_DtFirstSurg, '-', MONTH_DtFirstSurg, '-', DAY_DtFirstSurg)) IS NOT NULL AND TRY_CONVERT(DATE, CONCAT(YEAR_DtFirstSurg, '-', MONTH_DtFirstSurg, '-', DAY_DtFirstSurg)) <= GETDATE() THEN CAST(CONCAT(YEAR_DtFirstSurg, '-', MONTH_DtFirstSurg, '-', DAY_DtFirstSurg) AS DATE) ELSE NULL END AS DtFirstSurg, CASE WHEN YEAR_DtMstDefSurg IS NOT NULL AND MONTH_DtMstDefSurg IS NOT NULL AND DAY_DtMstDefSurg IS NOT NULL AND ISDATE(CONCAT(YEAR_DtMstDefSurg, '-', MONTH_DtMstDefSurg, '-', DAY_DtMstDefSurg)) IS NOT NULL AND TRY_CONVERT(DATE, CONCAT(YEAR_DtMstDefSurg, '-', MONTH_DtMstDefSurg, '-', DAY_DtMstDefSurg)) <= GETDATE() THEN CAST(CONCAT(YEAR_DtMstDefSurg, '-', MONTH_DtMstDefSurg, '-', DAY_DtMstDefSurg) AS DATE) ELSE NULL END AS DtMstDefSurg, CASE WHEN YEAR_DateAdmis IS NOT NULL AND MONTH_DateAdmis IS NOT NULL AND DAY_DateAdmis IS NOT NULL AND ISDATE(CONCAT(YEAR_DateAdmis, '-', MONTH_DateAdmis, '-', DAY_DateAdmis)) IS NOT NULL AND TRY_CONVERT(DATE, CONCAT(YEAR_DateAdmis, '-', MONTH_DateAdmis, '-', DAY_DateAdmis)) <= GETDATE() THEN CAST(CONCAT(YEAR_DateAdmis, '-', MONTH_DateAdmis, '-', DAY_DateAdmis) AS DATE) ELSE NULL END AS DATEAdmis, CASE WHEN YEAR_DtCA_Conf IS NOT NULL AND MONTH_DtCA_Conf IS NOT NULL AND DAY_DtCA_Conf IS NOT NULL AND ISDATE(CONCAT(YEAR_DtCA_Conf, '-', MONTH_DtCA_Conf, '-', DAY_DtCA_Conf)) IS NOT NULL AND TRY_CONVERT(DATE, CONCAT(YEAR_DtCA_Conf, '-', MONTH_DtCA_Conf, '-', DAY_DtCA_Conf)) <= GETDATE() THEN CAST(CONCAT(YEAR_DtCA_Conf, '-', MONTH_DtCA_Conf, '-', DAY_DtCA_Conf) AS DATE) ELSE NULL END AS DtCA_Conf, CASE WHEN YEAR_Dt2CA_Conf IS NOT NULL AND MONTH_Dt2CA_Conf IS NOT NULL AND DAY_Dt2CA_Conf IS NOT NULL AND ISDATE(CONCAT(YEAR_Dt2CA_Conf, '-', MONTH_Dt2CA_Conf, '-', DAY_Dt2CA_Conf)) IS NOT NULL AND TRY_CONVERT(DATE, CONCAT(YEAR_Dt2CA_Conf, '-', MONTH_Dt2CA_Conf, '-', DAY_Dt2CA_Conf)) <= GETDATE() THEN CAST(CONCAT(YEAR_Dt2CA_Conf, '-', MONTH_Dt2CA_Conf, '-', DAY_Dt2CA_Conf) AS DATE) ELSE NULL END AS Dt2CA_Conf, CASE WHEN YEAR_Dt3CA_Conf IS NOT NULL AND MONTH_Dt3CA_Conf IS NOT NULL AND DAY_Dt3CA_Conf IS NOT NULL AND ISDATE(CONCAT(YEAR_Dt3CA_Conf, '-', MONTH_Dt3CA_Conf, '-', DAY_Dt3CA_Conf)) IS NOT NULL AND TRY_CONVERT(DATE, CONCAT(YEAR_Dt3CA_Conf, '-', MONTH_Dt3CA_Conf, '-', DAY_Dt3CA_Conf)) <= GETDATE() THEN CAST(CONCAT(YEAR_Dt3CA_Conf, '-', MONTH_Dt3CA_Conf, '-', DAY_Dt3CA_Conf) AS DATE) ELSE NULL END AS Dt3CA_Conf, Elapsed1stSurgChem, Elapsed1stSurgLstCont, ElapsedChemo1stSurg, LengthToDtChemo, LengthToDtHorm, LengthToDtImmuno, LengthToDtMstDefSurg, LengthToDtRadStarted, LengthToDtTrnsplnt, LengthToFirstTx, ElapsedRTStartEnd, TumorSizeSumm, Survival, BestCSSummStage, BestCSTNMStage, T14UDF116, T14UDF117, T16UDF118, Abstractor, ClassCase, SeqPrim, Manage_MD, MedOncMD, RadOncMD, PrimSurgeon, Histology, PresCA_Conf, Pres2CA_Conf, Pres3CA_Conf, 'M' AS Source_System_Code, 'v_currtimestamp' AS DW_Last_Update_Date_Time FROM ( SELECT Tum.TumorId AS TumorId, Tum.PatientId AS PatientId, Tum.Grade AS Grade, Exta.CaseStatFlag AS CaseStatFlag, Tum.PrimarySite AS PrimarySite, Tum.Primsitesubcode AS Primsitesubcode, Tum.MstDefChemoSumm AS MstDefChemoSumm, Tum.MstDefDxStageSumm AS MstDefDxStageSumm, Tum.MstDefHormSumm AS MstDefHormSumm, Tum.MstDefImmunoSumm AS MstDefImmunoSumm, Tum.MstDefMarginsSumm AS MstDefMarginsSumm, Tum.MstDefPallSumm AS MstDefPallSumm, Tum.MstDefRTBoost AS MstDefRTBoost, Tum.MstDefRTHosp AS MstDefRTHosp, Tum.MstDefRTLoc AS MstDefRTLoc, Extb.ReasonNoChemo AS ReasonNoChemo, Extb.ReasonNoHormone AS ReasonNoHormone, Extb.ReasonNoImmuno AS ReasonNoImmuno, Extb.ReasonNoRad AS ReasonNoRad, Tum.MstDefSurgPrimSumm AS MstDefSurgPrimSumm, TRIM(TUM.CS_SSFactor1) AS CS_SS_Factor_1_Num_Code, TRIM(TUM.CS_SSFactor2) AS CS_SS_Factor_2_Num_Code, COALESCE(TRIM(TUM.CS_SSFactor15), '') AS CS_SS_Factor_15_Num_Code, COALESCE(TRIM(TUM.CS_SSFactor16), '') AS CS_SS_Factor_16_Num_Code, COALESCE(TRIM(TUM.CS_SSFactor22), '') AS CS_SS_Factor_22_Num_Code, COALESCE(TRIM(TUM.CS_SSFactor23), '') AS CS_SS_Factor_23_Num_Code, COALESCE(TRIM(TUM.CS_SSFactor25), '') AS CS_SS_FACTOR_25_NUM_CODE, Extb.ChemoSrgSeq AS ChemoSrgSeq, Tum.MstDefRTMod AS MstDefRTMod, Tum.MstDefRTVol AS MstDefRTVol, Tum.MstDefScopeLNSumm AS MstDefScopeLNSumm, Ext2.SurgAppHosp AS SurgAppHosp, Tum.MstDefSurgPrimHosp AS MstDefSurgPrimHosp, Tum.CS_TumSize AS CS_TumSize, Extb.Elapsed1stSurgChem AS Elapsed1stSurgChem, Extb.Elapsed1stSurgLstCont AS Elapsed1stSurgLstCont, Extb.ElapsedChemo1stSurg AS ElapsedChemo1stSurg, Extb.LengthToDtChemo AS LengthToDtChemo, Extb.LengthToDtHorm AS LengthToDtHorm, Extb.LengthToDtImmuno AS LengthToDtImmuno, Extb.LengthToDtMstDefSurg AS LengthToDtMstDefSurg, Extb.LengthToDtRadStarted AS LengthToDtRadStarted, Extb.LengthToDtTrnsplnt AS LengthToDtTrnsplnt, Extb.LengthToFirstTx AS LengthToFirstTx, Extb.ElapsedRTStartEnd AS ElapsedRTStartEnd, Exta.TumorSizeSumm AS TumorSizeSumm, Tum.Survival AS Survival, Tum.BestCSSummStage AS BestCSSummStage, TRIM(Tum.BestStage) AS BestCSTNMStage, Tum14.T14UDF116 AS T14UDF116, Tum14.T14UDF117 AS T14UDF117, Tum16.T16UDF118 AS T16UDF118, TRIM(Exta.Abstractor) AS Abstractor, Exta.ClassCase AS ClassCase, Exta.SeqPrim AS SeqPrim, Extb.Manage_MD AS Manage_MD, Extb.MedOncMD AS MedOncMD, Extb.RadOncMD AS RadOncMD, Extb.PrimSurgeon AS PrimSurgeon, tum.Histology AS Histology, Extb.PresCA_Conf, Extb.Pres2CA_Conf, Extb.Pres3CA_Conf AS Pres3CA_Conf, CASE WHEN LEN(RTRIM(CONVERT(numeric, DateAdmis))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, DateAdmis)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, DateAdmis)), 7, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, DateAdmis)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, DateAdmis)), 7, 2) END ELSE NULL END AS DAY_DateAdmis, CASE WHEN LEN(RTRIM(CONVERT(numeric, Dt2CA_Conf))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, Dt2CA_Conf)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, Dt2CA_Conf)), 7, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, Dt2CA_Conf)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, Dt2CA_Conf)), 7, 2) END ELSE NULL END AS DAY_Dt2CA_Conf, CASE WHEN LEN(RTRIM(CONVERT(numeric, Dt3CA_Conf))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, Dt3CA_Conf)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, Dt3CA_Conf)), 7, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, Dt3CA_Conf)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, Dt3CA_Conf)), 7, 2) END ELSE NULL END AS DAY_Dt3CA_Conf, CASE WHEN LEN(RTRIM(CONVERT(numeric, DtCA_Conf))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, DtCA_Conf)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, DtCA_Conf)), 7, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, DtCA_Conf)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, DtCA_Conf)), 7, 2) END ELSE NULL END AS DAY_DtCA_Conf, CASE WHEN LEN(RTRIM(CONVERT(numeric, DtFirstSurg))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, DtFirstSurg)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, DtFirstSurg)), 7, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, DtFirstSurg)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, DtFirstSurg)), 7, 2) END ELSE NULL END AS DAY_DtFirstSurg, CASE WHEN LEN(RTRIM(CONVERT(numeric, DtMstDefSurg))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, DtMstDefSurg)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, DtMstDefSurg)), 7, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, DtMstDefSurg)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, DtMstDefSurg)), 7, 2) END ELSE NULL END AS DAY_DtMstDefSurg, CASE WHEN LEN(RTRIM(CONVERT(numeric, MstDefChemoDt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, MstDefChemoDt)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, MstDefChemoDt)), 7, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, MstDefChemoDt)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, MstDefChemoDt)), 7, 2) END ELSE NULL END AS DAY_MstDefChemoDt, CASE WHEN LEN(RTRIM(CONVERT(numeric, MstDefHormDt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, MstDefHormDt)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, MstDefHormDt)), 7, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, MstDefHormDt)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, MstDefHormDt)), 7, 2) END ELSE NULL END AS DAY_MstDefHormDt, CASE WHEN LEN(RTRIM(CONVERT(numeric, MstDefImmunoDt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, MstDefImmunoDt)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, MstDefImmunoDt)), 7, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, MstDefImmunoDt)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, MstDefImmunoDt)), 7, 2) END ELSE NULL END AS DAY_MstDefImmunoDt, CASE WHEN LEN(RTRIM(CONVERT(numeric, MstDefRTDt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, MstDefRTDt)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, MstDefRTDt)), 7, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, MstDefRTDt)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, MstDefRTDt)), 7, 2) END ELSE NULL END AS DAY_MstDefRTDt, CASE WHEN LEN(RTRIM(CONVERT(numeric, MstDefRTStopDt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, MstDefRTStopDt)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, MstDefRTStopDt)), 7, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, MstDefRTStopDt)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, MstDefRTStopDt)), 7, 2) END ELSE NULL END AS DAY_MstDefRTStopDt, CASE WHEN LEN(RTRIM(CONVERT(numeric, DateAdmis))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, DateAdmis)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, DateAdmis)), 5, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, DateAdmis)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, DateAdmis)), 5, 2) END ELSE NULL END AS MONTH_DateAdmis, CASE WHEN LEN(RTRIM(CONVERT(numeric, Dt2CA_Conf))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, Dt2CA_Conf)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, Dt2CA_Conf)), 5, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, Dt2CA_Conf)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, Dt2CA_Conf)), 5, 2) END ELSE NULL END AS MONTH_Dt2CA_Conf, CASE WHEN LEN(RTRIM(CONVERT(numeric, Dt3CA_Conf))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, Dt3CA_Conf)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, Dt3CA_Conf)), 5, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, Dt3CA_Conf)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, Dt3CA_Conf)), 5, 2) END ELSE NULL END AS MONTH_Dt3CA_Conf, CASE WHEN LEN(RTRIM(CONVERT(numeric, DtCA_Conf))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, DtCA_Conf)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, DtCA_Conf)), 5, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, DtCA_Conf)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, DtCA_Conf)), 5, 2) END ELSE NULL END AS MONTH_DtCA_Conf, CASE WHEN LEN(RTRIM(CONVERT(numeric, DtFirstSurg))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, DtFirstSurg)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, DtFirstSurg)), 5, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, DtFirstSurg)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, DtFirstSurg)), 5, 2) END ELSE NULL END AS MONTH_DtFirstSurg, CASE WHEN LEN(RTRIM(CONVERT(numeric, DtMstDefSurg))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, DtMstDefSurg)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, DtMstDefSurg)), 5, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, DtMstDefSurg)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, DtMstDefSurg)), 5, 2) END ELSE NULL END AS MONTH_DtMstDefSurg, CASE WHEN LEN(RTRIM(CONVERT(numeric, MstDefChemoDt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, MstDefChemoDt)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, MstDefChemoDt)), 5, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, MstDefChemoDt)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, MstDefChemoDt)), 5, 2) END ELSE NULL END AS MONTH_MstDefChemoDt, CASE WHEN LEN(RTRIM(CONVERT(numeric, MstDefHormDt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, MstDefHormDt)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, MstDefHormDt)), 5, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, MstDefHormDt)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, MstDefHormDt)), 5, 2) END ELSE NULL END AS MONTH_MstDefHormDt, CASE WHEN LEN(RTRIM(CONVERT(numeric, MstDefImmunoDt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, MstDefImmunoDt)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, MstDefImmunoDt)), 5, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, MstDefImmunoDt)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, MstDefImmunoDt)), 5, 2) END ELSE NULL END AS MONTH_MstDefImmunoDt, CASE WHEN LEN(RTRIM(CONVERT(numeric, MstDefRTDt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, MstDefRTDt)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, MstDefRTDt)), 5, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, MstDefRTDt)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, MstDefRTDt)), 5, 2) END ELSE NULL END AS MONTH_MstDefRTDt, CASE WHEN LEN(RTRIM(CONVERT(numeric, MstDefRTStopDt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, MstDefRTStopDt)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, MstDefRTStopDt)), 5, 2) = '00' THEN '01' WHEN TRY_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, MstDefRTStopDt)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, MstDefRTStopDt)), 5, 2) END ELSE NULL END AS MONTH_MstDefRTStopDt, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, DateAdmis)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, DateAdmis))), 1, 4) ELSE NULL END AS YEAR_DateAdmis, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, Dt2CA_Conf)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, Dt2CA_Conf))), 1, 4) ELSE NULL END AS YEAR_Dt2CA_Conf, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, Dt3CA_Conf)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, Dt3CA_Conf))), 1, 4) ELSE NULL END AS YEAR_Dt3CA_Conf, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, DtCA_Conf)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, DtCA_Conf))), 1, 4) ELSE NULL END AS YEAR_DtCA_Conf, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, DtFirstSurg)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, DtFirstSurg))), 1, 4) ELSE NULL END AS YEAR_DtFirstSurg, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, DtMstDefSurg)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, DtMstDefSurg))), 1, 4) ELSE NULL END AS YEAR_DtMstDefSurg, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, MstDefChemoDt)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, MstDefChemoDt))), 1, 4) ELSE NULL END AS YEAR_MstDefChemoDt, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, MstDefHormDt)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, MstDefHormDt))), 1, 4) ELSE NULL END AS YEAR_MstDefHormDt, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, MstDefImmunoDt)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, MstDefImmunoDt))), 1, 4) ELSE NULL END AS YEAR_MstDefImmunoDt, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, MstDefRTDt)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, MstDefRTDt))), 1, 4) ELSE NULL END AS YEAR_MstDefRTDt, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, MstDefRTStopDt)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, MstDefRTStopDt))), 1, 4) ELSE NULL END AS YEAR_MstDefRTStopDt FROM mRegistry.dbo.Tumor Tum LEFT OUTER JOIN mRegistry.dbo.TumorExt1b Extb ON Tum.Tumorid = Extb.Tumorid LEFT OUTER JOIN mRegistry.dbo.TumorExt1a Exta ON Tum.Tumorid = Exta.Tumorid LEFT OUTER JOIN mRegistry.dbo.TumorExt2 Ext2 ON Tum.Tumorid = Ext2.Tumorid LEFT OUTER JOIN mRegistry.dbo.TumorExt14 Tum14 ON Tum.Tumorid = Tum14.Tumorid LEFT OUTER JOIN mRegistry.dbo.TumorExt16 Tum16 ON Tum.Tumorid = Tum16.Tumorid ) mm~250000"
]

tblist15: [
  "21~mregistry.dbo.contacts~v_cr_stage_dataset_name.cr_patient_contact_stg~append~SELECT contactid AS patient_contact_id, patientid AS cr_patient_id, relation AS contact_relation_id, type AS contact_type_id, contactcode AS contact_num_code, TRIM(cntfirstname) AS contact_first_name, TRIM(cntlastname) AS contact_last_name, TRIM(cntmiddlename) AS contact_middle_name, TRIM(CAST(remarks AS VARCHAR(MAX))) AS preferred_contact_method_text, 'M' AS source_system_code, 'v_currtimestamp' AS dw_last_update_date_time FROM ( SELECT C.contactid, patientid, relation, type, contactcode, cntfirstname, cntlastname, cntmiddlename, remarks FROM MREGISTRY.DBO.CONTACTS (nolock) C INNER JOIN ( SELECT contactid, COUNT(*) CNT FROM MREGISTRY.DBO.CONTACTS (nolock) GROUP BY contactid HAVING COUNT(*)= 1 ) A ON C.contactid = A.contactid UNION ALL SELECT contactid, patientid, relation, type, contactcode, cntfirstname, cntlastname, cntmiddlename, remarks FROM ( SELECT *, ROW_NUMBER() OVER( PARTITION BY contactid ORDER BY contactshospid DESC ) RN FROM MREGISTRY.DBO.CONTACTS (nolock) WHERE contactid IN ( SELECT C.contactid FROM MREGISTRY.DBO.CONTACTS (nolock) C INNER JOIN ( SELECT contactid, COUNT(*) CNT FROM MREGISTRY.DBO.CONTACTS (nolock) GROUP BY contactid HAVING COUNT(*)> 1 ) A ON C.contactid = A.contactid INNER JOIN MREGISTRY.DBO.CONTACTS (nolock) C1 ON C.contactid = C1.contactid AND C1.contactshospid IS NULL ) ) B WHERE B.RN = 1 ) C~250000"
]

tblist16: [
  "22~mregistry.dbo.contacts~v_cr_stage_dataset_name.cr_patient_phone_num_stg~append~select coalesce(c.ContactId,-99) as Contact_Id, p.PatientId as Patient_Id, coalesce('H','') as Phone_Num_Type_Code, TRIM(p.phone) as Phone_Num, 'M' as source_system_code,'v_currtimestamp' as dw_last_update_date_time from mregistry.dbo.Patient p (nolock) left outer join ( select c.ContactId, PatientId, Relation, CellPhone, HomePhone  from mregistry.dbo.contacts c (nolock) inner join (select contactid,count(*) cnt from mregistry.dbo.contacts (nolock) group by contactid having count(*)=1) a on c.contactid=a.contactid union all select ContactId, PatientId, Relation, CellPhone, HomePhone from (select *,row_number() over(partition by contactid order by contactshospid desc) rn from mregistry.dbo.contacts (nolock) where contactid in ( select  c.contactid   from mregistry.dbo.contacts c (nolock) inner join (select contactid,count(*) cnt from mregistry.dbo.contacts group by contactid having count(*)>1) a on c.contactid=a.contactid inner join mregistry.dbo.contacts c1 on c.contactid=c1.contactid and c1.contactshospid is null ) ) b where b.rn=1 )  c on p.PatientId=c.PatientId and c.Relation='00' Union select ContactId as Contact_Id, coalesce(c.PatientId,-99) as Patient_Id, coalesce('C','') as Phone_Num_Type_Code, TRIM(c.cellphone) as Phone_Num, 'M' as source_system_code,'v_currtimestamp' as dw_last_update_date_time from ( select c.ContactId, PatientId, Relation, CellPhone, HomePhone from mregistry.dbo.contacts c (nolock) inner join (select contactid,count(*) cnt from mregistry.dbo.contacts (nolock) group by contactid having count(*)=1) a on c.contactid=a.contactid union all select ContactId, PatientId, Relation, CellPhone, HomePhone  from (select *,row_number() over(partition by contactid order by contactshospid desc) rn from mregistry.dbo.contacts (nolock) where contactid in ( select  c.contactid  from mregistry.dbo.contacts c (nolock) inner join (select contactid,count(*) cnt from mregistry.dbo.contacts (nolock) group by contactid having count(*)>1) a on c.contactid=a.contactid inner join mregistry.dbo.contacts c1 on c.contactid=c1.contactid and c1.contactshospid is null ) ) b where b.rn=1 )  c where c.cellphone is not null and c.cellphone<>'' Union select ContactId as Contact_Id, coalesce(c.PatientId,-99) as Patient_Id, coalesce('H','') as Phone_Num_Type_Code, TRIM(c.homephone) as Phone_Num, 'M' as source_system_code,'v_currtimestamp' as dw_last_update_date_time from ( select c.ContactId, PatientId, Relation, CellPhone, HomePhone from mregistry.dbo.contacts c (nolock) inner join (select contactid,count(*) cnt from mregistry.dbo.contacts (nolock) group by contactid having count(*)=1) a on c.contactid=a.contactid union all select ContactId, PatientId, Relation, CellPhone, HomePhone  from (select *,row_number() over(partition by contactid order by contactshospid desc) rn from mregistry.dbo.contacts (nolock) where contactid in ( select  c.contactid   from mregistry.dbo.contacts c (nolock) inner join (select contactid,count(*) cnt from mregistry.dbo.contacts (nolock) group by contactid having count(*)>1) a on c.contactid=a.contactid inner join mregistry.dbo.contacts c1 on c.contactid=c1.contactid and c1.contactshospid is null ) ) b where b.rn=1 )  c where c.Relation<>'00' and c.homephone is not null and c.homephone<>''~250000"
]

tblist17: [
  "23~mregistry.dbo.patient~v_cr_stage_dataset_name.cr_patient_treatment_stg1~append~select treatment.treatmentid,treatment.rxcode, l2371.description,l2371.groupid from mregistry.dbo.patient (nolock) inner join mregistry.dbo.tumorext1a on tumorext1a.patientid = patient.patientid left outer join mregistry.dbo.treatment on treatment.tumorid = tumorext1a.tumorid left outer join  mdictionary .dbo.lookupcodes as l2371 on l2371.lookupid = 4043 and l2371.code = treatment.rxcode and l2371.subcode = treatment.rxsubcode inner join (select  patientid ,t1.tumorid ,t2.treatmentid ,max (t3.groupid) as groupid from mregistry.dbo.tumor t1 (nolock) left join mregistry.dbo.treatment t2 on t1.tumorid = t2.tumorid inner join  mdictionary.dbo.lookupgroups t3  on  t3.beginhisto <= left(t1.histology,4) and t3.endhisto >= left(t1.histology,4) and t3.beginprimarysite <= case right(t1.primarysite, 3) when '***' then '000' else right(t1.primarysite, 3) end  and t3.endprimarysite >= case right(t1.primarysite, 3) when '***' then '000' else right(t1.primarysite, 3) end  and t3.beginrxtype <= case t2.rxtype when 'd' then '0' when 'p' then '1' when 's' then '2' when 'r' then '3' when 'c' then '4' when 'h' then '5' when 'i' then '6' when 't' then '7' when 'o' then '8' end and t3.endrxtype >= case t2.rxtype when 'd' then '0' when 'p' then '1' when 's' then '2' when 'r' then '3' when 'c' then '4' when 'h' then '5' when 'i' then '6' when 't' then '7' when 'o' then '8' end and t3.lookupid = 4043  group by patientid ,t1.tumorid ,t2.treatmentid )sq1 on sq1.groupid = l2371.groupid and treatment.treatmentid = sq1.treatmentid~250000"
]

tblist18: [
  "24~mregistry.dbo.treatment~v_cr_stage_dataset_name.cr_patient_treatment_stg~append~select  treatmentid, tumorid, treatmenthospid, rxcode, description, groupid, othercode, surgmarg, rxtype, CASE WHEN (clinical_trial_start_year IS NOT NULL AND clinical_trial_start_month IS NOT NULL AND clinical_trial_start_day IS NOT NULL) AND TRY_CONVERT(DATE, CONCAT(clinical_trial_start_year, '-', clinical_trial_start_month, '-', clinical_trial_start_day)) IS NOT NULL AND TRY_CONVERT(DATE, CONCAT(clinical_trial_start_year, '-', clinical_trial_start_month, '-', clinical_trial_start_day)) <= GETDATE() THEN TRY_CONVERT(DATE, CONCAT(clinical_trial_start_year, '-', clinical_trial_start_month, '-', clinical_trial_start_day)) ELSE NULL END AS dtprotocol, CASE WHEN (treatment_start_year IS NOT NULL AND treatment_start_month IS NOT NULL AND treatment_start_day IS NOT NULL) AND TRY_CONVERT(DATE, CONCAT(treatment_start_year, '-', treatment_start_month, '-', treatment_start_day)) IS NOT NULL AND TRY_CONVERT(DATE, CONCAT(treatment_start_year, '-', treatment_start_month, '-', treatment_start_day)) <= GETDATE() THEN TRY_CONVERT(DATE, CONCAT(treatment_start_year, '-', treatment_start_month, '-', treatment_start_day)) ELSE NULL END AS dtrxstart, prottitle, rxtxt, rxmd1 from ( select  treatmentid, tumorid, treatmenthospid, rxcode, null as description, null as groupid, othercode, surgmarg, rxtype, REPLACE(REPLACE(cast(COALESCE(prottitle,'') as varchar(1000)), NCHAR(8211), NCHAR(32)), NCHAR(8217), NCHAR(32)) as prottitle, REPLACE(REPLACE(cast(COALESCE(rxtxt,'') as varchar(4000)), NCHAR(8211), NCHAR(32)), NCHAR(8217), NCHAR(32)) as rxtxt, REPLACE(REPLACE(TRIM(COALESCE(rx_md1,'')), NCHAR(8211), NCHAR(32)), NCHAR(8217), NCHAR(32)) as rxmd1 , CASE  WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, dtprotocol)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, dtprotocol))), 1, 4) ELSE NULL END AS clinical_trial_start_year, CASE  WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, dtprotocol)))) = 8 THEN  CASE  WHEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, dtprotocol))), 5, 2) = '99'  OR SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, dtprotocol))), 5, 2) = '00' THEN '01' WHEN CAST(SUBSTRING(LTRIM(RTRIM(CONVERT(numeric,dtprotocol))), 5, 2) AS int) > 12 THEN NULL ELSE SUBSTRING(LTRIM(RTRIM(CONVERT(numeric,dtprotocol))), 5, 2) END ELSE NULL END AS clinical_trial_start_month, CASE  WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, dtprotocol)))) = 8 THEN  CASE  WHEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, dtprotocol))), 7, 2) = '99'  OR SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, dtprotocol))), 7, 2) = '00' THEN '01' WHEN CAST(SUBSTRING(LTRIM(RTRIM(CONVERT(numeric,dtprotocol))), 7, 2) AS int) > 31 THEN NULL ELSE SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, dtprotocol))), 7, 2) END ELSE NULL END AS clinical_trial_start_day,  CASE  WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, dtrxstart)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, dtrxstart))), 1, 4) ELSE NULL END AS treatment_start_year, CASE  WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, dtrxstart)))) = 8 THEN  CASE  WHEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, dtrxstart))), 5, 2) = '99'  OR SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, dtrxstart))), 5, 2) = '00' THEN '01' WHEN CAST(SUBSTRING(LTRIM(RTRIM(CONVERT(numeric,dtrxstart))), 5, 2) AS int) > 12 THEN NULL ELSE SUBSTRING(LTRIM(RTRIM(CONVERT(numeric,dtrxstart))), 5, 2) END ELSE NULL END AS treatment_start_month, CASE  WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, dtrxstart)))) = 8 THEN  CASE  WHEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, dtrxstart))), 7, 2) = '99'  OR SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, dtrxstart))), 7, 2) = '00' THEN '01' WHEN CAST(SUBSTRING(LTRIM(RTRIM(CONVERT(numeric,dtrxstart))), 7, 2) AS int) > 31 THEN NULL ELSE SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, dtrxstart))), 7, 2) END ELSE NULL END AS treatment_start_day from mregistry.dbo.treatment (nolock)) mm~250000"
]

tblist19: [
  "25~mregistry.dbo.tumorext1b~v_cr_stage_dataset_name.cr_patient_staging_sample_stage~append~Select ext1.Patientid as Patientid,	ext1.Tumorid as Tumorid, 'C' AS Cancer_Stge_Clsfctn_Mthd_Cde,	'T' AS Cancer_Stage_Type_Code, TRIM(ext1.Clin_T_TNM) as Clin_T_TNM,	TRIM(ext1.AJCCStageGroupClin) as AJCCStageGroupClin, coalesce(TRIM(tum1.code),'') as CODE, coalesce(tum1.sub,'') as sub, coalesce(tum1.group1,'') as group1, 'M' AS Source_System_Code, 'v_currtimestamp' AS DW_Last_Update_Date_Time from mregistry.dbo.tumorext1b ext1 LEFT JOIN ( SELECT  distinct	Case when L2371.Description is null or  L2371.Description= '' then '-99' else TumorExt1b.AJCCStageGroupClin end as code, Case when L2371.Description is null or  L2371.Description= ''  then 'Unknown Description' else L2371.Description end as AJCCStageGroupClin_Desc ,Case when L2371.Description is null or  L2371.Description= ''  then -99 else L2371.SubCode end as sub	,Case when L2371.Description is null or  L2371.Description= ''  then -99 else SQ1.GroupID end as group1	,Tumor.tumorid as tumorid1 FROM MRegistry.dbo.Tumor JOIN MRegistry.dbo.TumorExt1b  ON Tumor.tumorid = TumorExt1b.tumorid 	Inner JOIN 	(SELECT	MAX (GROUPID) as GroupID ,LookupID ,t1.TumorID FROM MRegistry.dbo.Tumor t1	JOIN MRegistry.dbo.TumorExt1b t2 ON t1.tumorid = t2.tumorid INNER JOIN MDictionary.dbo.LookupGroups t3 ON  t3.beginhisto <= left(t1.histology,4) AND t3.endhisto >= left(t1.histology,4) 	AND t3.beginprimarysite <= CASE RIGHT(t1.primarysite, 3) WHEN '***' THEN '000' ELSE RIGHT(t1.primarysite, 3) END 	AND t3.endprimarysite >= CASE RIGHT(t1.primarysite, 3) WHEN '***' THEN '000' ELSE RIGHT(t1.primarysite, 3) END AND t3.beginedition <= t2.tnm_Edition AND t3.endedition >= t2.tnm_Edition AND LookupID = '4040' GROUP BY	LookupID ,t1.TumorID )SQ1	ON Tumor.TumorID = SQ1.TumorID	LEFT JOIN [MDictionary].dbo.LookupCodes as L2371 ON L2371.LookupID = '4040'	AND L2371.Code = AJCCStageGroupClin	 AND SQ1.GroupID = L2371.GroupID AND L2371.SubCode=ClinGrpSubCode)tum1 ON tum1.tumorid1 =ext1.Tumorid where Clin_T_TNM is not null~250000"
]

tblist20: [
  "26~mregistry.dbo.tumorext1b~v_cr_stage_dataset_name.cr_patient_staging_sample_stage~append~Select ext2.Patientid, ext2.Tumorid,	'C' AS Cancer_Stge_Clsfctn_Mthd_Cde, 'N' AS Cancer_Stage_Type_Code,	TRIM(ext2.Clin_N_TNM) as Clin_T_TNM, ext2.AJCCStageGroupClin, TRIM(tum2.code) as code, tum2.sub as sub, tum2.group1 as group1, 'M' AS Source_System_Code, 'v_currtimestamp' AS DW_Last_Update_Date_Time from mregistry.dbo.tumorext1b ext2	 LEFT JOIN (SELECT  distinct Case when L2371.Description is null or  L2371.Description= '' then '-99' else TumorExt1b.AJCCStageGroupClin end as code, Case when L2371.Description is null or  L2371.Description= ''  then 'Unknown Description' else L2371.Description end as AJCCStageGroupClin_Desc ,Case when L2371.Description is null or  L2371.Description= ''  then -99 else L2371.SubCode end as sub		 ,Case when L2371.Description is null or  L2371.Description= ''  then -99 else SQ1.GroupID end as group1 ,Tumor.tumorid as tumorid1 FROM MRegistry.dbo.Tumor JOIN MRegistry.dbo.TumorExt1b ON Tumor.tumorid = TumorExt1b.tumorid Inner JOIN (SELECT MAX (GROUPID) as GroupID ,LookupID ,t1.TumorID FROM MRegistry.dbo.Tumor t1 JOIN MRegistry.dbo.TumorExt1b t2 ON t1.tumorid = t2.tumorid INNER JOIN MDictionary.dbo.LookupGroups t3 ON  t3.beginhisto <= left(t1.histology,4) AND t3.endhisto >= left(t1.histology,4) AND t3.beginprimarysite <= CASE RIGHT(t1.primarysite, 3) WHEN '***' THEN '000' ELSE RIGHT(t1.primarysite, 3) END AND t3.endprimarysite >= CASE RIGHT(t1.primarysite, 3) WHEN '***' THEN '000' ELSE RIGHT(t1.primarysite, 3) END AND t3.beginedition <= t2.tnm_Edition AND t3.endedition >= t2.tnm_Edition AND LookupID = '4040' GROUP BY LookupID	,t1.TumorID)SQ1 ON Tumor.TumorID = SQ1.TumorID LEFT JOIN [MDictionary].dbo.LookupCodes as L2371 ON L2371.LookupID = '4040' AND L2371.Code = AJCCStageGroupClin AND SQ1.GroupID = L2371.GroupID AND L2371.SubCode=ClinGrpSubCode)tum2 ON tum2.tumorid1 =ext2.Tumorid where Clin_N_TNM is not null~250000"
]

tblist21: [
  "27~mregistry.dbo.tumorext1b~v_cr_stage_dataset_name.cr_patient_staging_sample_stage~append~Select	ext3.Patientid, ext3.Tumorid,	'C' AS Cancer_Stge_Clsfctn_Mthd_Cde, 'M' AS Cancer_Stage_Type_Code,	TRIM(ext3.Clin_M_TNM) as Clin_T_TNM, ext3.AJCCStageGroupClin, TRIM(tum3.code) as code, tum3.sub as sub, tum3.group1 as group1, 'M' AS Source_System_Code, 'v_currtimestamp' AS DW_Last_Update_Date_Time from mregistry.dbo.tumorext1b ext3	 LEFT JOIN (SELECT  distinct Case when L2371.Description is null or  L2371.Description= '' then '-99' else TumorExt1b.AJCCStageGroupClin end as code, Case when L2371.Description is null or  L2371.Description= ''  then 'Unknown Description' else L2371.Description end as AJCCStageGroupClin_Desc ,Case when L2371.Description is null or  L2371.Description= ''  then -99 else L2371.SubCode end as sub ,Case when L2371.Description is null or  L2371.Description= ''  then -99 else SQ1.GroupID end as group1 ,Tumor.tumorid as tumorid1 FROM MRegistry.dbo.Tumor JOIN MRegistry.dbo.TumorExt1b ON Tumor.tumorid = TumorExt1b.tumorid Inner JOIN (SELECT MAX (GROUPID) as GroupID ,LookupID ,t1.TumorID FROM MRegistry.dbo.Tumor t1 JOIN MRegistry.dbo.TumorExt1b t2 ON t1.tumorid = t2.tumorid INNER JOIN MDictionary.dbo.LookupGroups t3 ON  t3.beginhisto <= left(t1.histology,4) AND t3.endhisto >= left(t1.histology,4) AND t3.beginprimarysite <= CASE RIGHT(t1.primarysite, 3) WHEN '***' THEN '000' ELSE RIGHT(t1.primarysite, 3) END AND t3.endprimarysite >= CASE RIGHT(t1.primarysite, 3) WHEN '***' THEN '000' ELSE RIGHT(t1.primarysite, 3) END AND t3.beginedition <= t2.tnm_Edition AND t3.endedition >= t2.tnm_Edition AND LookupID = '4040' GROUP BY LookupID ,t1.TumorID)SQ1 ON Tumor.TumorID = SQ1.TumorID LEFT JOIN [MDictionary].dbo.LookupCodes as L2371 ON L2371.LookupID = '4040' AND L2371.Code = AJCCStageGroupClin AND SQ1.GroupID = L2371.GroupID AND L2371.SubCode=ClinGrpSubCode)tum3 ON tum3.tumorid1 =ext3.Tumorid where Clin_M_TNM is not null~250000"
]

tblist22: [
  "28~mregistry.dbo.tumorext1b~v_cr_stage_dataset_name.cr_patient_staging_sample_stage~append~Select	ext4.Patientid,	ext4.Tumorid,	'C' AS Cancer_Stge_Clsfctn_Mthd_Cde, null AS Cancer_Stage_Type_Code, null as Clin_T_TNM, ext4.AJCCStageGroupClin, TRIM(tum4.code) as code, tum4.sub as sub, tum4.group1 as group1, 'M' AS Source_System_Code, 'v_currtimestamp' AS DW_Last_Update_Date_Time  from mregistry.dbo.tumorext1b ext4 LEFT JOIN (SELECT  distinct Case when L2371.Description is null or  L2371.Description= '' then '-99' else TumorExt1b.AJCCStageGroupClin end as code, Case when L2371.Description is null or  L2371.Description= ''  then 'Unknown Description' else L2371.Description end as AJCCStageGroupClin_Desc ,Case when L2371.Description is null or  L2371.Description= ''  then -99 else L2371.SubCode end as sub ,Case when L2371.Description is null or  L2371.Description= ''  then -99 else SQ1.GroupID end as group1 ,Tumor.tumorid as tumorid1 FROM MRegistry.dbo.Tumor JOIN MRegistry.dbo.TumorExt1b ON Tumor.tumorid = TumorExt1b.tumorid Inner JOIN (SELECT MAX (GROUPID) as GroupID ,LookupID ,t1.TumorID FROM MRegistry.dbo.Tumor t1 JOIN MRegistry.dbo.TumorExt1b t2 ON t1.tumorid = t2.tumorid INNER JOIN MDictionary.dbo.LookupGroups t3 ON  t3.beginhisto <= left(t1.histology,4) AND t3.endhisto >= left(t1.histology,4) AND t3.beginprimarysite <= CASE RIGHT(t1.primarysite, 3) WHEN '***' THEN '000' ELSE RIGHT(t1.primarysite, 3) END AND t3.endprimarysite >= CASE RIGHT(t1.primarysite, 3) WHEN '***' THEN '000' ELSE RIGHT(t1.primarysite, 3) END AND t3.beginedition <= t2.tnm_Edition AND t3.endedition >= t2.tnm_Edition AND LookupID = '4040' GROUP BY LookupID ,t1.TumorID)SQ1 ON Tumor.TumorID = SQ1.TumorID LEFT JOIN [MDictionary].dbo.LookupCodes as L2371 ON L2371.LookupID = '4040' AND L2371.Code = AJCCStageGroupClin AND SQ1.GroupID = L2371.GroupID AND L2371.SubCode=ClinGrpSubCode)tum4 ON tum4.tumorid1 =ext4.Tumorid	 where Clin_M_TNM is  null and Clin_N_TNM is  null and Clin_T_TNM is  null~250000"
]

tblist23: [
  "29~mregistry.dbo.tumorext1b~v_cr_stage_dataset_name.cr_patient_staging_sample_stage~append~Select	ext5.Patientid, ext5.Tumorid,	'P' AS Cancer_Stge_Clsfctn_Mthd_Cde,	'T'  AS Cancer_Stage_Type_Code, TRIM(ext5.Path_T_TNM) as Clin_T_TNM, ext5.AJCCStageGroupPath as AJCCStageGroupClin, TRIM(tum5.code) as code, tum5.sub as sub, tum5.group1 as group1, 'M' AS Source_System_Code, 'v_currtimestamp' AS DW_Last_Update_Date_Time from mregistry.dbo.tumorext1b	ext5 LEFT JOIN (SELECT  distinct Case when L2371.Description is null or  L2371.Description= '' then '-99' else TumorExt1b.AJCCStageGroupPath end as code, Case when L2371.Description is null or  L2371.Description= ''  then 'Unknown Description' else L2371.Description end as AJCCStageGroupPath_Desc ,Case when L2371.Description is null or  L2371.Description= ''  then -99 else L2371.SubCode end as sub ,Case when L2371.Description is null or  L2371.Description= ''  then -99 else SQ1.GroupID end as group1 ,Tumor.tumorid as tumorid1 FROM MRegistry.dbo.Tumor JOIN MRegistry.dbo.TumorExt1b ON Tumor.tumorid = TumorExt1b.tumorid Inner JOIN (SELECT MAX (GROUPID) as GroupID ,LookupID ,t1.TumorID FROM MRegistry.dbo.Tumor t1 JOIN MRegistry.dbo.TumorExt1b t2 ON t1.tumorid = t2.tumorid INNER JOIN MDictionary.dbo.LookupGroups t3 ON  t3.beginhisto <= left(t1.histology,4) AND t3.endhisto >= left(t1.histology,4) AND t3.beginprimarysite <= CASE RIGHT(t1.primarysite, 3) WHEN '***' THEN '000' ELSE RIGHT(t1.primarysite, 3) END AND t3.endprimarysite >= CASE RIGHT(t1.primarysite, 3) WHEN '***' THEN '000' ELSE RIGHT(t1.primarysite, 3) END AND t3.beginedition <= t2.tnm_Edition AND t3.endedition >= t2.tnm_Edition AND LookupID = '4040' GROUP BY LookupID ,t1.TumorID)SQ1 ON Tumor.TumorID = SQ1.TumorID LEFT JOIN [MDictionary].dbo.LookupCodes as L2371 ON L2371.LookupID = '4040' AND L2371.Code = AJCCStageGroupPath AND L2371.SubCode= PathGrpSubCode AND SQ1.GroupID = L2371.GroupID )tum5 ON  ext5.Tumorid= tum5.tumorid1 where Path_T_TNM is not null~250000"
]

tblist24: [
  "30~mregistry.dbo.tumorext1b~v_cr_stage_dataset_name.cr_patient_staging_sample_stage~append~Select	ext6.Patientid,	ext6.Tumorid,	'P' AS Cancer_Stge_Clsfctn_Mthd_Cde, 'N' AS Cancer_Stage_Type_Code, TRIM(ext6.Path_N_TNM) as Clin_T_TNM, ext6.AJCCStageGroupPath as AJCCStageGroupClin, TRIM(tum6.code) as code, tum6.sub as sub, tum6.group1 as group1, 'M' AS Source_System_Code, 'v_currtimestamp' AS DW_Last_Update_Date_Time from mregistry.dbo.tumorext1b	ext6 LEFT JOIN (SELECT  distinct Case when L2371.Description is null or  L2371.Description= '' then '-99' else TumorExt1b.AJCCStageGroupPath end as code, Case when L2371.Description is null or  L2371.Description= ''  then 'Unknown Description' else L2371.Description end as AJCCStageGroupPath_Desc ,Case when L2371.Description is null or  L2371.Description= ''  then -99 else L2371.SubCode end as sub ,Case when L2371.Description is null or  L2371.Description= ''  then -99 else SQ1.GroupID end as group1 ,Tumor.tumorid as tumorid1 FROM MRegistry.dbo.Tumor JOIN MRegistry.dbo.TumorExt1b ON Tumor.tumorid = TumorExt1b.tumorid Inner JOIN (SELECT MAX (GROUPID) as GroupID ,LookupID ,t1.TumorID FROM MRegistry.dbo.Tumor t1 JOIN MRegistry.dbo.TumorExt1b t2 ON t1.tumorid = t2.tumorid INNER JOIN MDictionary.dbo.LookupGroups t3 ON  t3.beginhisto <= left(t1.histology,4) AND t3.endhisto >= left(t1.histology,4) AND t3.beginprimarysite <= CASE RIGHT(t1.primarysite, 3) WHEN '***' THEN '000' ELSE RIGHT(t1.primarysite, 3) END AND t3.endprimarysite >= CASE RIGHT(t1.primarysite, 3) WHEN '***' THEN '000' ELSE RIGHT(t1.primarysite, 3) END AND t3.beginedition <= t2.tnm_Edition AND t3.endedition >= t2.tnm_Edition AND LookupID = '4040' GROUP BY LookupID ,t1.TumorID)SQ1 ON Tumor.TumorID = SQ1.TumorID LEFT JOIN [MDictionary].dbo.LookupCodes as L2371 ON L2371.LookupID = '4040' AND L2371.Code = AJCCStageGroupPath AND L2371.SubCode= PathGrpSubCode AND SQ1.GroupID = L2371.GroupID )tum6 ON  ext6.Tumorid= tum6.tumorid1 where Path_N_TNM is not null~250000"
]

tblist25: [
  "31~mregistry.dbo.tumorext1b~v_cr_stage_dataset_name.cr_patient_staging_sample_stage~append~Select	ext7.Patientid, ext7.Tumorid,	'P' AS Cancer_Stge_Clsfctn_Mthd_Cde, 'M' AS Cancer_Stage_Type_Code, TRIM(ext7.Path_M_TNM) as Clin_T_TNM, ext7.AJCCStageGroupPath as AJCCStageGroupClin, TRIM(tum7.code) as code, tum7.sub as sub, tum7.group1 as group1, 'M' AS Source_System_Code, 'v_currtimestamp' AS DW_Last_Update_Date_Time from mregistry.dbo.tumorext1b	ext7  LEFT JOIN (SELECT  distinct Case when L2371.Description is null or  L2371.Description= '' then '-99' else TumorExt1b.AJCCStageGroupPath end as code, Case when L2371.Description is null or  L2371.Description= ''  then 'Unknown Description' else L2371.Description end as AJCCStageGroupPath_Desc ,Case when L2371.Description is null or  L2371.Description= ''  then -99 else L2371.SubCode end as sub ,Case when L2371.Description is null or  L2371.Description= ''  then -99 else SQ1.GroupID end as group1 ,Tumor.tumorid as tumorid1 FROM MRegistry.dbo.Tumor JOIN MRegistry.dbo.TumorExt1b ON Tumor.tumorid = TumorExt1b.tumorid Inner JOIN (SELECT MAX (GROUPID) as GroupID ,LookupID ,t1.TumorID FROM MRegistry.dbo.Tumor t1 JOIN MRegistry.dbo.TumorExt1b t2 ON t1.tumorid = t2.tumorid INNER JOIN MDictionary.dbo.LookupGroups t3 ON  t3.beginhisto <= left(t1.histology,4) AND t3.endhisto >= left(t1.histology,4) AND t3.beginprimarysite <= CASE RIGHT(t1.primarysite, 3) WHEN '***' THEN '000' ELSE RIGHT(t1.primarysite, 3) END AND t3.endprimarysite >= CASE RIGHT(t1.primarysite, 3) WHEN '***' THEN '000' ELSE RIGHT(t1.primarysite, 3) END AND t3.beginedition <= t2.tnm_Edition AND t3.endedition >= t2.tnm_Edition AND LookupID = '4040' GROUP BY LookupID ,t1.TumorID)SQ1 ON Tumor.TumorID = SQ1.TumorID LEFT JOIN [MDictionary].dbo.LookupCodes as L2371 ON L2371.LookupID = '4040' AND L2371.Code = AJCCStageGroupPath AND L2371.SubCode= PathGrpSubCode AND SQ1.GroupID = L2371.GroupID )tum7 ON  ext7.Tumorid= tum7.tumorid1 where Path_M_TNM is not null~250000"
]

tblist26: [
  "32~mregistry.dbo.tumorext1b~v_cr_stage_dataset_name.cr_patient_staging_sample_stage~append~Select	ext8.Patientid,	ext8.Tumorid,	'P' AS Cancer_Stge_Clsfctn_Mthd_Cde, null AS Cancer_Stage_Type_Code, null as Clin_T_TNM, ext8.AJCCStageGroupPath as AJCCStageGroupClin, TRIM(tum8.code) as code, tum8.sub as sub, tum8.group1 as group1, 'M' AS Source_System_Code, 'v_currtimestamp' AS DW_Last_Update_Date_Time from mregistry.dbo.tumorext1b	ext8  LEFT JOIN (SELECT  distinct Case when L2371.Description is null or  L2371.Description= '' then '-99' else TumorExt1b.AJCCStageGroupPath end as code, Case when L2371.Description is null or  L2371.Description= ''  then 'Unknown Description' else L2371.Description end as AJCCStageGroupPath_Desc ,Case when L2371.Description is null or  L2371.Description= ''  then -99 else L2371.SubCode end as sub ,Case when L2371.Description is null or  L2371.Description= ''  then -99 else SQ1.GroupID end as group1 ,Tumor.tumorid as tumorid1 FROM MRegistry.dbo.Tumor JOIN MRegistry.dbo.TumorExt1b ON Tumor.tumorid = TumorExt1b.tumorid Inner JOIN (SELECT MAX (GROUPID) as GroupID ,LookupID ,t1.TumorID FROM MRegistry.dbo.Tumor t1 JOIN MRegistry.dbo.TumorExt1b t2 ON t1.tumorid = t2.tumorid INNER JOIN MDictionary.dbo.LookupGroups t3 ON  t3.beginhisto <= left(t1.histology,4) AND t3.endhisto >= left(t1.histology,4) AND t3.beginprimarysite <= CASE RIGHT(t1.primarysite, 3) WHEN '***' THEN '000' ELSE RIGHT(t1.primarysite, 3) END AND t3.endprimarysite >= CASE RIGHT(t1.primarysite, 3) WHEN '***' THEN '000' ELSE RIGHT(t1.primarysite, 3) END AND t3.beginedition <= t2.tnm_Edition AND t3.endedition >= t2.tnm_Edition AND LookupID = '4040' GROUP BY LookupID ,t1.TumorID)SQ1 ON Tumor.TumorID = SQ1.TumorID LEFT JOIN [MDictionary].dbo.LookupCodes as L2371 ON L2371.LookupID = '4040' AND L2371.Code = AJCCStageGroupPath AND L2371.SubCode= PathGrpSubCode AND SQ1.GroupID = L2371.GroupID )tum8 ON  ext8.Tumorid= tum8.tumorid1	 where Path_M_TNM is  null and Path_N_TNM is  null and Path_T_TNM is  null~250000"
]

#DAG_5
tblist27: [
  "33~mregistry.dbo.vw_cerrtconcordance~v_cr_stage_dataset_name.cerrt_concrodant_ind~append~select patientid, tumorid, cerrt_concrodant_ind, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.vw_cerrtconcordance (nolock)~100000",
  "34~mregistry.dbo.vw_cerctconcordance~v_cr_stage_dataset_name.cerct_concrodant_ind~append~select patientid, tumorid, cerct_concrodant_ind, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.vw_cerctconcordance (nolock)~100000",
  "35~mregistry.dbo.vw_endctrtconcordance~v_cr_stage_dataset_name.endctrt_concordant_ind~append~select patientid, tumorid, endctrt_concordant_ind, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.vw_endctrtconcordance (nolock)~100000",
  "36~mregistry.dbo.vw_cbrrtconcordance~v_cr_stage_dataset_name.cbrrt_concordant_ind~append~select patientid, tumorid, cbrrt_concordant_ind, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.vw_cbrrtconcordance (nolock)~100000",
  "37~mregistry.dbo.vw_g15rlnconcordance~v_cr_stage_dataset_name.g15rln_concordant_ind~append~select patientid, tumorid, g15rln_concordant_ind, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.vw_g15rlnconcordance (nolock)~100000",
  "38~mregistry.dbo.vw_lctconcordance~v_cr_stage_dataset_name.lct_concordant_ind~append~select patientid, tumorid, lct_concordant_ind, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.vw_lctconcordance (nolock)~100000"
]

tblist28: [
  "39~mregistry.dbo.vw_recrtctconcordance~v_cr_stage_dataset_name.recrtct_concordant_ind~append~select patientid, tumorid, recrtct_concordant_ind, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.vw_recrtctconcordance (nolock)~100000",
  "40~mregistry.dbo.vw_mastrtconcordance~v_cr_stage_dataset_name.mastrt_concordant_ind~append~select patientid, tumorid, mastrt_concordant_ind, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.vw_mastrtconcordance (nolock)~100000",
  "41~mregistry.dbo.vw_ovsalconcordance~v_cr_stage_dataset_name.ovsal_concordant_ind~append~select patientid, tumorid, ovsal_concordant_ind, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.vw_ovsalconcordance (nolock)~100000",
  "42~mregistry.dbo.vw_actconcordance~v_cr_stage_dataset_name.act_concordant_ind~append~select patientid, tumorid, act_concordant_ind, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.vw_actconcordance (nolock)~100000"
]

tblist29: [
  "43~mregistry.dbo.vw_macconcordance~v_cr_stage_dataset_name.mac_concordant_ind~append~select patientid, tumorid, mac_concordant_ind, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.vw_macconcordance (nolock)~100000",
  "44~mregistry.dbo.vw_lnosurgconcordance~v_cr_stage_dataset_name.lnosurg_concordant_ind~append~select patientid, tumorid, lnosurg_concordant_ind, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.vw_lnosurgconcordance (nolock)~100000",
  "45~mregistry.dbo.vw_endlrcconcordance~v_cr_stage_dataset_name.endlrc_concordant_ind~append~select patientid, tumorid, endlrc_concordant_ind, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.vw_endlrcconcordance (nolock)~100000",
  "46~mregistry.dbo.vw_10rlnconcordance~v_cr_stage_dataset_name.rln10_concordant_ind~append~select patientid, tumorid, rln10_concordant_ind, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.vw_10rlnconcordance (nolock)~100000"
]

tblist30: [
  "47~mregistry.dbo.vw_12rlnconcordance~v_cr_stage_dataset_name.rln12_concordant_ind~append~select patientid, tumorid, rln12_concordant_ind, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.vw_12rlnconcordance (nolock)~100000",
  "48~mregistry.dbo.vw_bcsrtconcordance~v_cr_stage_dataset_name.bcsrt_concordant_ind~append~select patientid, tumorid, bcsrt_concordant_ind, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.vw_bcsrtconcordance (nolock)~100000",
  "49~mregistry.dbo.vw_htconcordance~v_cr_stage_dataset_name.ht_concordant_ind~append~select patientid, tumorid, ht_concordant_ind, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.vw_htconcordance (nolock)~100000"
]

tblist31: [
  "50~mregistry.dbo.vw_bcsconcordance~v_cr_stage_dataset_name.bcs_concordant_ind~append~select patientid, tumorid, bcs_concordant_ind, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.vw_bcsconcordance (nolock)~100000",
  "51~mregistry.dbo.vw_nbxconcordance~v_cr_stage_dataset_name.nb_concordant_ind~append~select patientid, tumorid, nb_concordant_ind, 'v_currtimestamp' as dw_last_update_date_time from  mregistry.dbo.vw_nbxconcordance (nolock)~100000"
]

schedule:
  - schedule_interval: 0 1 * * *
    start_date: pendulum.datetime(2023, 11, 19, tz=timezone)
    frequency: daily
    dag_id_suffix: 1
    done_file: NONE
    has_sensor: 'No'
    trigger_dag_ids: ['dag_integrate_metriq_sqlserver_daily_01']
    tblist: [tblist1, tblist2]
    truncatetablelist: ['v_cr_stage_dataset_name.ref_icd_oncology_stg','v_cr_stage_dataset_name.ref_icd_oncology_diag_cd_stg','v_cr_stage_dataset_name.cr_system_user_stg']
  
  - schedule_interval: 30 2 * * *
    start_date: pendulum.datetime(2023, 11, 19, tz=timezone)
    frequency: daily
    dag_id_suffix: 2
    done_file: NONE
    has_sensor: 'No'
    trigger_dag_ids: ['dag_ingest_opol_sqlserver_daily_01']
    tblist: [tblist3,tblist4,tblist5,tblist6,tblist7,tblist8,tblist9,tblist10,tblist11,tblist12,tblist13,tblist14,tblist15,tblist16,tblist17,tblist18,tblist19,tblist20,tblist21,tblist22,tblist23,tblist24,tblist25,tblist26]
    truncatetablelist: ['v_cr_stage_dataset_name.ref_lookup_groups_stg','v_cr_stage_dataset_name.ref_lookup_code_stg','v_cr_stage_dataset_name.ref_treatment_type_group_stg','v_cr_stage_dataset_name.ref_hospital_stg','v_cr_stage_dataset_name.ref_cr_treatment_type_stg','v_cr_stage_dataset_name.ref_national_svc_center_stg','v_cr_stage_dataset_name.cr_patient_medical_oncology_stg','v_cr_stage_dataset_name.cr_system_productivity_log_stg','v_cr_stage_dataset_name.cr_patient_radiation_oncology_stg','v_cr_stage_dataset_name.cr_patient_address_stg','v_cr_stage_dataset_name.cr_patient_stg','v_cr_stage_dataset_name.cr_patient_history_stg','v_cr_stage_dataset_name.cr_pat_tumor_pathology_result_stg','v_cr_stage_dataset_name.cr_patient_diagnosis_detail_stg','v_cr_stage_dataset_name.cr_patient_insurance_stg','v_cr_stage_dataset_name.cr_patient_tumor_stg','v_cr_stage_dataset_name.cr_patient_contact_stg','v_cr_stage_dataset_name.cr_patient_phone_num_stg','v_cr_stage_dataset_name.cr_patient_treatment_stg1','v_cr_stage_dataset_name.cr_patient_treatment_stg','v_cr_stage_dataset_name.cr_patient_staging_sample_stage']
    
  - schedule_interval: None
    start_date: pendulum.datetime(2023, 11, 19, tz=timezone)
    frequency: daily
    dag_id_suffix: 3
    done_file: NONE
    has_sensor: 'No'
    trigger_dag_ids: ['dag_integrate_metriq_sqlserver_daily_03']
    tblist: [tblist27,tblist28,tblist29,tblist30,tblist31]
    truncatetablelist: ['v_cr_stage_dataset_name.cerrt_concrodant_ind','v_cr_stage_dataset_name.cerct_concrodant_ind','v_cr_stage_dataset_name.endctrt_concordant_ind','v_cr_stage_dataset_name.cbrrt_concordant_ind','v_cr_stage_dataset_name.g15rln_concordant_ind','v_cr_stage_dataset_name.lct_concordant_ind','v_cr_stage_dataset_name.recrtct_concordant_ind','v_cr_stage_dataset_name.mastrt_concordant_ind','v_cr_stage_dataset_name.ovsal_concordant_ind','v_cr_stage_dataset_name.act_concordant_ind','v_cr_stage_dataset_name.mac_concordant_ind','v_cr_stage_dataset_name.lnosurg_concordant_ind','v_cr_stage_dataset_name.endlrc_concordant_ind','v_cr_stage_dataset_name.rln10_concordant_ind','v_cr_stage_dataset_name.rln12_concordant_ind','v_cr_stage_dataset_name.bcsrt_concordant_ind','v_cr_stage_dataset_name.ht_concordant_ind','v_cr_stage_dataset_name.bcs_concordant_ind','v_cr_stage_dataset_name.nb_concordant_ind']