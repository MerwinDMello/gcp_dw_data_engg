SELECT CAST(DATEPART(yyyy, stm.stmmdate) AS CHAR(4)) || $MVFMT(CAST(DATEPART(mm, stm.stmmdate) AS CHAR(2)), '2"0"R') AS rptg_period, 'TMP' AS artiva_instance, pas.hcpsid AS ssc, cpt.cspersisttimefac, cpt.cspersisttimeid, cpt.cspersisttimeptnum, fac.csfacoidnum, fac.csfahospnum, ctc.ctclkey, CASE WHEN (((CONVERT(INT, ctc.ctclendtm)) - (CONVERT(INT, ctc.ctclinittm)) )/60) >= 1 THEN 'N' WHEN (((CONVERT(INT, ctc.ctclendtm)) - (CONVERT(INT, ctc.ctclinittm)) )/60) <1 THEN 'Y' END AS ctc_short_call, CASE WHEN ctc.ctcltype = 'PG' THEN 'Progressive' ELSE 'Manual' END AS call_type, stm.stmmkey, stm.csvtcalllogid, CAST(stm.csvthcenid AS VARCHAR(15)) AS csvthcenid, SUBSTR(stm.csvtpool, 1, 6) AS csvtpool, stm.hcvthcacid, SUBSTR(stm.stmmdesc, 1, (charindex('-', stm.stmmdesc) - 2)) AS calc_stm_hcvthcacid, CAST(stm.stmmdesc AS VARCHAR(75)) AS stmmdesc, stm.stmmfile, CAST(stm.stmmdate AS VARCHAR(10)) AS stm_file_create_date, (CONVERT(INT, stm.stmmdate)) AS stm_file_create_date_int, CAST(stm.stmmtime AS VARCHAR(8)) AS stm_file_create_time, (CONVERT(INT, stm.stmmtime)) AS stm_file_create_time_int, stm.stmmtype, stm.stmmuser, SUBSTR(stm.stmmuser, 1, 7) AS agent_id, stm.stvtcall, stm.stvtlen, round((stm.stvtlen/60), 11) AS stm_record_length_min, stm.stvtpool, stm.stvtrtyp, stu.hcuadept, SUBSTR(stu.hcuadept, 1, 3) AS department, stu.uafullname, gcp.gcdid, gcp.gcpoolnum, gcp.gcpdesc, gcp.gcptype, CASE WHEN gcp.gcptype = 'D' THEN 'Progressive' WHEN gcp.gcptype = 'N' AND gcp.gcdid = 'HCACTS' THEN 'Manual' WHEN gcp.gcptype = 'N' AND gcp.gcdid IS NULL THEN 'Non-Dialing' END AS dialer_type FROM sqluser.stmultimedia stm LEFT JOIN sqluser.stuser stu ON stm.stmmuser = stu.userid LEFT JOIN sqluser.ctcalllog ctc ON stm.csvtcalllogid = ctc.ctclkey LEFT JOIN (SELECT DISTINCT cspersisttimefac, cspersisttimeid, cspersisttimeptnum FROM sqluser.cspersisttimeacct WHERE cspersisttimefac IS NOT NULL AND cspersisttimeid IS NOT NULL ) cpt ON SUBSTR(stm.stmmdesc, 1, (charindex('-', stm.stmmdesc) - 2)) = cpt.cspersisttimeid LEFT JOIN sqluser.hcfacility fac ON cpt.cspersisttimefac = fac.hcfaid LEFT JOIN sqluser.hcpas pas ON fac.hcfapasid = pas.hcpsid LEFT JOIN sqluser.gcpool gcp ON stm.stvtpool = gcp.gcpoolnum WHERE stm.stmmdate = DATEADD(dd, -1, CURRENT_DATE) AND (stu.hcuadept LIKE '902%' OR stu.hcuadept LIKE '602%' OR stu.hcuadept LIKE '913%' OR stu.hcuadept LIKE '613%' OR stu.hcuadept LIKE '916%' OR stu.hcuadept LIKE '616%' ) AND stm.stvtpool<> '|TCP|16000|713723' ORDER BY stm.stmmkey