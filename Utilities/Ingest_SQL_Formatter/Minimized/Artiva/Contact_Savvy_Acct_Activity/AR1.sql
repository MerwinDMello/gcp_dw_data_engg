SELECT CAST(DATEPART(yyyy, cpt.cspersisttimedate) AS CHAR(4)) || $MVFMT(CAST(DATEPART(mm, cpt.cspersisttimedate) AS CHAR(2)), '2"0"R') AS rptg_period, 'TMP' AS artiva_instance, pas.hcpsid AS ssc, cpt.cspersisttimefac, fac.csfacoidnum, fac.csfahospnum, cpt.cspersisttimekey, cpt.cspersisttimeacbal, cpt.cspersisttimeactcds, cpt.cspersisttimeactnotw, cpt.cspersisttimeactwrkd, CAST(cpt.cspersisttimedate AS VARCHAR(10)) AS cpt_user_on_acct_date, (CONVERT(INT, cpt.cspersisttimedate)) AS cpt_user_on_acct_date_int, cpt.cspersisttimedept, cpt.cspersisttimeencntr, cpt.cspersisttimeentotch, CAST(cpt.cspersisttimeetime AS VARCHAR(8)) AS cpt_end_time, (CONVERT(INT, cpt.cspersisttimeetime)) AS cpt_end_time_int, cpt.cspersisttimeficlass, cpt.cspersisttimehold, cpt.cspersisttimehospnum, cpt.cspersisttimeid, cpt.cspersisttimeiplan, cpt.cspersisttimepool, cpt.cspersisttimeptnum, cpt.cspersisttimepyid, cpt.cspersisttimepyr, cpt.cspersisttimeseqnum, CAST(cpt.cspersisttimestime AS VARCHAR(8)) AS cpt_start_time, (CONVERT(INT, cpt.cspersisttimestime)) AS cpt_start_time_int, CAST(cpt.cspersisttimetime AS VARCHAR(8)) AS cpt_log_time, (CONVERT(INT, cpt.cspersisttimetime)) AS cpt_log_time_int, cpt.cspersisttimettime, (cpt.cspersisttimettime * 60) AS cpt_user_on_acct, cpt.cspersisttimeuser, SUBSTR(cpt.cspersisttimeuser, 1, 7) AS agent_id, cpt.cspersisttimevtime, (cpt.cspersisttimevtime * 60) AS cpt_not_worked_min, cpt.cspersisttimewktime, (cpt.cspersisttimewktime * 60) AS cpt_worked_min, cpt.cspersisttimewebstat, stu.hcuadept, SUBSTR(stu.hcuadept, 1, 3) AS department, stu.uafullname, gcp.gcdid, gcp.gcpoolnum, gcp.gcpdesc, gcp.gcptype, CASE WHEN gcp.gcptype = 'D' THEN 'Progressive' WHEN gcp.gcptype = 'N' AND gcp.gcdid = 'HCACTS' THEN 'Manual' WHEN gcp.gcptype = 'N' AND gcp.gcdid IS NULL THEN 'Non-Dialing' END AS dialer_type, hcp.cspyfacilityid, hcp.cspyiplan, hcp.cspyipdesc, hcp.cspytopbal, hcp.cspyhighbal, hcp.cspylowbal, hcp.cspyultralowbal, CASE WHEN cpt.cspersisttimeacbal < hcp.cspyultralowbal THEN 'Ultra-Low' WHEN cpt.cspersisttimeacbal >=hcp.cspyultralowbal AND cpt.cspersisttimeacbal <= hcp.cspylowbal THEN 'Low' WHEN cpt.cspersisttimeacbal > hcp.cspylowbal AND cpt.cspersisttimeacbal < hcp.cspyhighbal THEN 'Medium' WHEN cpt.cspersisttimeacbal >= hcp.cspyhighbal AND cpt.cspersisttimeacbal < hcp.cspytopbal THEN 'High' WHEN cpt.cspersisttimeacbal >= hcp.cspytopbal THEN 'Top' END AS balance_strat, cmp.csmpid, cmp.csmpdesc FROM sqluser.cspersisttimeacct cpt LEFT JOIN sqluser.stuser stu ON cpt.cspersisttimeuser = stu.userid LEFT JOIN sqluser.hcfacility fac ON cpt.cspersisttimefac = fac.hcfaid LEFT JOIN sqluser.hcpas pas ON fac.hcfapasid = pas.hcpsid LEFT JOIN sqluser.gcpool gcp ON cpt.cspersisttimepool = gcp.gcpoolnum LEFT JOIN sqluser.hcpayer hcp ON cpt.cspersisttimefac = hcp.cspyfacilityid AND cpt.cspersisttimeiplan = hcp.cspyiplan LEFT JOIN sqluser.csmajorpayer CMP ON hcp.cspymajorpyid = cmp.csmpid WHERE cpt.cspersisttimedate = DATEADD(dd, -1, CURRENT_DATE) AND (stu.hcuadept LIKE '902%' OR stu.hcuadept LIKE '602%' OR stu.hcuadept LIKE '913%' OR stu.hcuadept LIKE '613%' OR stu.hcuadept LIKE '916%' OR stu.hcuadept LIKE '616%' ) ORDER BY cpt.cspersisttimekey