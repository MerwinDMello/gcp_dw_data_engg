SELECT CURRENT_DATE AS report_date, 'AR1' AS artiva_instance, CAST(right('00000' || csmrhfacility, 5) AS CHAR(5)) AS unit_num, CASE WHEN csmrhpatacct = 0 THEN e.hcenptacct ELSE csmrhpatacct END AS pat_acct_num, e.hcenbal AS encounter_balance, e.hcenorigbal AS total_charges, e.hcentotadj*-1 AS total_adjustments, e.hcentotpay AS total_payments, e.hcenacctbal AS total_balance_of_liabilities, SUBSTRING(csmrhid, 1, 19) AS doc_req_id, SUBSTRING(csmrhiplan, 1, 5) AS doc_req_iplan_id, SUBSTRING(csmrhpayerdesc, 1, 30) AS doc_req_payer_name, SUBSTRING(csmrhstatus, 1, 6) AS doc_req_status, csmrhdte AS doc_req_submit_date, csmrhreqdte AS doc_req_request_date, csmrhsentdte AS doc_req_sent_date, csmrhrecvddte AS doc_req_received_date, SUBSTRING(csmrhiplan, 1, 5) AS doc_req_detail_iplan_id, SUBSTRING(csmrhpayerdesc, 1, 30) AS doc_req_detail_payer_name, csmrhdte AS doc_req_detail_create_date, SUBSTRING(csmrhrequserid, 1, 8) AS doc_req_detail_user_id, SUBSTRING(csmrhdept, 1, 20) AS doc_req_detail_dept, SUBSTRING(csmrhreviewtype, 1, 30) AS doc_req_detail_review_type, csmrhreqdte AS doc_req_detail_request_date, SUBSTRING(csmrhreqreason, 1, 50) AS doc_req_detail_request_reason, SUBSTRING(csmrhreqothreason, 1, 50) AS doc_req_detail_request_other_reason, SUBSTRING(csmrhreqmedrec, 1, 1) AS doc_req_detail_comp_med_rec_ind, SUBSTRING(csmrhappmedrec, 1, 1) AS doc_req_detail_comp_med_rec_approved, SUBSTRING(csmrhreqadmitorder, 1, 1) AS doc_req_detail_admit_order_ind, SUBSTRING(csmrhappadmitorder, 1, 1) AS doc_req_detail_admit_order_approved, SUBSTRING(csmrhreqdschsummary, 1, 1) AS doc_req_detail_dsh_summary_ind, SUBSTRING(csmrhappdschsummary, 1, 1) AS doc_req_detail_dsh_summary_approved, SUBSTRING(csmrhreqerreport, 1, 1) AS doc_req_detail_er_report_ind, SUBSTRING(csmrhapperreport, 1, 1) AS doc_req_detail_er_report_approved, SUBSTRING(csmrhreqaccdetail, 1, 1) AS doc_req_detail_accident_det_ind, SUBSTRING(csmrhappaccdetail, 1, 1) AS doc_req_detail_accident_det_approved, SUBSTRING(csmrhreqitemizedbill, 1, 1) AS doc_req_detail_itemized_bill_ind, SUBSTRING(csmrhappitemizedbill, 1, 1) AS doc_req_detail_itemized_bill_approved, SUBSTRING(csmrhreqimplantinv, 1, 1) AS doc_req_detail_implant_inv_ind, SUBSTRING(csmrhappimplantinv, 1, 1) AS doc_req_detail_implant_inv_approved, SUBSTRING(csmrhreqother, 1, 30) AS doc_req_detail_other_desc, SUBSTRING(csmrappqother, 1, 1) AS doc_req_detail_other_approved, SUBSTRING(csmrhcovltr, 1, 1) AS doc_req_detail_cover_letter_required, SUBSTRING(csmrhpmailname, 1, 40) AS doc_req_detail_payer_name_mailto, SUBSTRING(csmrhvendor, 1, 3) AS doc_req_detail_vendor, SUBSTRING(csmrhvmailname, 1, 40) AS doc_req_detail_vendor_mail_name, SUBSTRING(csmrhmailaddr1, 1, 60) AS doc_req_detail_address1_mailto, SUBSTRING(csmrhmailaddr2, 1, 40) AS doc_req_detail_address2_mailto, SUBSTRING(csmrhmailcity, 1, 35) AS doc_req_detail_city_mailto, SUBSTRING(csmrhmailst, 1, 2) AS doc_req_detail_state_mailto, SUBSTRING(csmrhmailzip, 1, 20) AS doc_req_detail_zip_mailto, SUBSTRING(csmrhdeliverymethod, 1, 10) AS doc_req_detail_delivery_method, COALESCE(csmrhpyrfax, 0) AS doc_req_detail_payer_fax, SUBSTRING(csmrhpyremail, 1, 40) AS doc_req_detail_payer_email, csmrhsentdte AS doc_req_detail_sent_date, SUBSTRING(csmrhmailtracknbr, 1, 60) AS doc_req_detail_tracking_number, csmrhrecvddte AS doc_req_detail_received_date, SUBSTRING(csmrhrecptconfirmno, 1, 30) AS doc_req_detail_receipt_conf_number, SUBSTRING(csmrhmailsignby, 1, 50) AS doc_req_detail_signed_by, csmrhapprovedte AS doc_req_detail_approve_date, csmrhclaimsubdte AS doc_req_detail_claim_submit_date, csmrhdenydte AS doc_req_detail_deny_date, csmrhdte AS doc_req_detail_rh_date, csmrhduedte AS doc_req_detail_rh_due_date, csmrhibreqdte AS doc_req_detail_ib_request_date, csmrhibsentdte AS doc_req_detail_ib_sent_date, csmrhltr1sentdte AS doc_req_detail_letter_1_sent_date, csmrhltr2sentdte AS doc_req_detail_letter_2_sent_date, csmrhltr3sentdte AS doc_req_detail_letter_3_sent_date, csmrhmailrcptdte AS doc_req_detail_mail_rcpt_date, csmrhmrreqdte AS doc_req_detail_mr_request_date, csmrhmrsentdte AS doc_req_detail_mr_sent_date, csmrhppmcsentdte AS doc_req_detail_ppmc_sent_date, SUBSTRING(csmrhppmcflag, 1, 1) AS doc_req_detail_ppmc_flag FROM sqluser.csmedicalrechist h LEFT OUTER JOIN sqluser.hcencounter e ON e.hcenid = h.csmrhenid LEFT OUTER JOIN sqluser.hcfacility f ON f.hcfaid = e.hcenfacility LEFT OUTER JOIN sqluser.hcpas s ON s.hcpsid = f.hcfapasid WHERE csmrhid IS NOT NULL AND csmrhpatacct IS NOT NULL AND (CASE WHEN csmrhpatacct = 0 AND h.csmrhenid IS NULL THEN 'N' ELSE 'Y' END) = 'Y'