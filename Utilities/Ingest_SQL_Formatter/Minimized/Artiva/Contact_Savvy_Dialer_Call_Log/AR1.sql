SELECT CAST(DATEPART(yyyy, ctc.ctclinitdt) AS CHAR(4)) || $MVFMT(CAST(DATEPART(mm, ctc.ctclinitdt) AS CHAR(2)), '2"0"R') AS rptg_period, 'TMP' AS artiva_instance, pas.hcpsid AS ssc, cpt.cspersisttimefac, cpt.cspersisttimeid, cpt.cspersisttimeptnum, fac.csfacoidnum, fac.csfahospnum, ctc.ctclkey, ctc.csclholdtime, ctc.csctclpool, ctc.ctclacct, CAST(ctc.ctcladdti AS VARCHAR(10)) AS ctc_dialed_date, (CONVERT(INT, ctc.ctcladdti)) AS ctc_dialed_date_int, CAST(ctc.ctcladtmi AS VARCHAR(8)) AS ctc_dialed_time, (CONVERT(INT, ctc.ctcladtmi)) AS ctc_dialed_time_int, ctc.ctclmanual, ctc.ctclitalk, ctc.ctcltalk, ctc.ctclotalk, ctc.ctclphone, ctc.ctclpool, ctc.ctclrecfile, ctc.ctclrecord, ctc.ctclupdate, ctc.ctclwait, ctc.ctcltype, CASE WHEN ctc.ctcltype = 'PG' THEN 'Progressive' ELSE 'Manual' END AS call_type, ctc.ctclagent, SUBSTR(ctc.ctclagent, 1, 7) AS agent_id, CAST(ctc.ctclinitdt AS VARCHAR(10)) AS ctc_init_date, (CONVERT(INT, ctc.ctclinitdt)) AS ctc_init_date_int, CAST(ctc.ctclinittm AS VARCHAR(8)) AS ctc_call_init_time, (CONVERT(INT, ctc.ctclinittm)) AS ctc_call_init_time_int, CAST(ctc.ctclenddt AS VARCHAR(10)) AS ctc_end_date, (CONVERT(INT, ctc.ctclenddt)) AS ctc_end_date_int, CAST(ctc.ctclendtm AS VARCHAR(8)) AS ctc_call_end_time, (CONVERT(INT, ctc.ctclendtm)) AS ctc_call_end_time_int, ((CONVERT(INT, ctc.ctclendtm)) - (CONVERT(INT, ctc.ctclinittm)) ) AS ctc_call_length, (((CONVERT(INT, ctc.ctclendtm)) - (CONVERT(INT, ctc.ctclinittm)) )/60) AS ctc_call_length_min, CASE WHEN (((CONVERT(INT, ctc.ctclendtm)) - (CONVERT(INT, ctc.ctclinittm)) )/60) >= 1 THEN 'N' WHEN (((CONVERT(INT, ctc.ctclendtm)) - (CONVERT(INT, ctc.ctclinittm)) )/60) <1 THEN 'Y' END AS ctc_short_call, stu.hcuadept, SUBSTR(stu.hcuadept, 1, 3) AS department, stu.uafullname, gcp.gcdid, gcp.gcpoolnum, gcp.gcpdesc, gcp.gcptype, CASE WHEN gcp.gcptype = 'D' THEN 'Progressive' WHEN gcp.gcptype = 'N' AND gcp.gcdid = 'HCACTS' THEN 'Manual' WHEN gcp.gcptype = 'N' AND gcp.gcdid IS NULL THEN 'Non-Dialing' END AS dialer_type FROM sqluser.ctcalllog ctc LEFT JOIN sqluser.gcpool gcp ON ctc.csctclpool=gcp.gcpoolnum LEFT JOIN sqluser.stuser stu ON ctc.ctclagent=stu.userid LEFT JOIN (SELECT DISTINCT cspersisttimefac, cspersisttimeid, cspersisttimeptnum FROM sqluser.cspersisttimeacct WHERE cspersisttimefac IS NOT NULL AND cspersisttimeid IS NOT NULL ) cpt ON ctc.ctclacct = cpt.cspersisttimeid LEFT JOIN sqluser.hcfacility fac ON cpt.cspersisttimefac = fac.hcfaid LEFT JOIN sqluser.hcpas pas ON fac.hcfapasid = pas.hcpsid WHERE ctc.ctclinitdt = DATEADD(dd, -1, CURRENT_DATE) AND (stu.hcuadept LIKE '902%' OR stu.hcuadept LIKE '602%' OR stu.hcuadept LIKE '913%' OR stu.hcuadept LIKE '613%' OR stu.hcuadept LIKE '916%' OR stu.hcuadept LIKE '616%') ORDER BY ctc.ctclkey