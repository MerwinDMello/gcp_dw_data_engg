SELECT claim_id, vendor_cid, unit_num, unit_num AS numeric_unit_num, numeric_patient_acct_num, service_code, taxonomy_code, destination_method, bill_type_code, stgb.billing_provider_sid AS bill_provider_sid, stgp.pay_to_provider_sid AS pay_to_provider_sid, total_charge_amt, payor_seq_ind, iplan_id, bill_dt, (CASE SUBSTRING(patient_acc_num, 1, 1) WHEN 'D' THEN SUBSTRING(patient_acc_num, 2, 39) WHEN 'R' THEN SUBSTRING(patient_acc_num, 2, 39) WHEN 'H' THEN SUBSTRING(patient_acc_num, 2, 39) WHEN 'S' THEN SUBSTRING(patient_acc_num, 2, 39) WHEN 'P' THEN SUBSTRING(patient_acc_num, 2, 39) ELSE patient_acc_num END)AS patient_acct_num, med_rec_num, fed_tax_num, CAST(stmt_cover_from_dt AS DATE) AS stmt_cover_from_dt, CAST(stmt_cover_to_dt AS DATE) AS stmt_cover_to_dt, CAST(admission_dt AS DATE) AS admission_dt, CAST(admission_hr AS CHAR(2)) AS admission_hr, admission_type_ind, admission_source AS admission_source_cd, CAST(discharge_hr AS CHAR(2)) AS discharge_hr, discharge_status AS discharge_status_cd, accident_state AS accident_st, npi, admit_diag_code, drg, claim_remark AS claim_desc, SUBSTRING(archive_file_location, 1, datalength(archive_file_location) - charindex(CHAR(92), reverse(archive_file_location))) AS file_link_path_txt, SUBSTRING(archive_file_location, datalength(archive_file_location) - charindex(CHAR(92), reverse(archive_file_location)) + 2, charindex(CHAR(92), reverse(archive_file_location)) - 1) AS claim_file_name, (CASE SUBSTRING(patient_acc_num, 1, 1) WHEN 'D' THEN 'D' WHEN 'R' THEN 'R' WHEN 'H' THEN 'H' WHEN 'S' THEN 'S' WHEN 'P' THEN 'P' ELSE NULL END) AS prefix_pat_acct_num, vendor_cid AS pas_coid, financial_class, patient_type, NULL AS dw_last_update_date_time, b.source_system_code AS edi_837_type, NULL AS source_system_code FROM claimsconnectdb.dbo.fact_claim b WITH (nolock) LEFT JOIN claimsconnectdb.dbo.lu_billing_provider bp WITH (nolock) ON bp.bill_provider_npi = b.npi AND bp.billing_provider_sid = b.claim_id LEFT JOIN claimsconnectdb.dbo.dw_billing_provider stgb WITH (nolock) ON bp.bill_prov_provider_city = stgb.bill_prov_provider_city AND bp.bill_provider_addr1 = stgb.bill_provider_addr1 AND (stgb.bill_provider_addr2 = bp.bill_provider_addr2 OR (bp.bill_provider_addr2 IS NULL AND stgb.bill_provider_addr2 IS NULL)) AND bp.bill_provider_npi = stgb.bill_provider_npi AND bp.bill_provider_name = stgb.bill_provider_name AND bp.bill_provider_st = stgb.bill_provider_st AND bp.bill_provider_zip =stgb.bill_provider_zip AND stgb.bill_provider_npi = bp.bill_provider_npi LEFT JOIN claimsconnectdb.dbo.lu_pay_to_provider pp WITH (nolock) ON pp.provider_npi = b.npi AND pp.pay_to_provider_sid = b.claim_id LEFT JOIN claimsconnectdb.dbo.dw_pay_to_provider stgp WITH (nolock) ON pp.provider_city = stgp.provider_city AND pp.provider_addr1 = stgp.provider_addr1 AND (stgp.provider_addr2 = pp.provider_addr2 OR (pp.provider_addr2 IS NULL AND stgp.provider_addr2 IS NULL)) AND pp.provider_npi = stgp.provider_npi AND (pp.provider_name = stgp.provider_name OR (pp.provider_name IS NULL AND stgp.provider_name IS NULL)) AND pp.provider_st = stgp.provider_st AND pp.provider_zip =stgp.provider_zip AND stgp.provider_npi = pp.provider_npi