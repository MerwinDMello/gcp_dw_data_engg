SELECT tumorid, patientid, grade, casestatflag, primarysite, primsitesubcode, mstdefchemosumm, mstdefdxstagesumm, mstdefhormsumm, mstdefimmunosumm, mstdefmarginssumm, mstdefpallsumm, mstdefrtboost, mstdefrthosp, mstdefrtloc, reasonnochemo, reasonnohormone, reasonnoimmuno, reasonnorad, mstdefsurgprimsumm, cs_ss_factor_1_num_code, cs_ss_factor_2_num_code, cs_ss_factor_15_num_code, cs_ss_factor_16_num_code, cs_ss_factor_22_num_code, cs_ss_factor_23_num_code, cs_ss_factor_25_num_code, chemosrgseq, mstdefrtmod, mstdefrtvol, mstdefscopelnsumm, surgapphosp, mstdefsurgprimhosp, cs_tumsize, CASE WHEN year_mstdefchemodt IS NOT NULL AND month_mstdefchemodt IS NOT NULL AND day_mstdefchemodt IS NOT NULL AND isdate(concat(year_mstdefchemodt, '-', month_mstdefchemodt, '-', day_mstdefchemodt)) IS NOT NULL AND try_CONVERT(DATE, concat(year_mstdefchemodt, '-', month_mstdefchemodt, '-', day_mstdefchemodt)) <= getdate() THEN CAST(concat(year_mstdefchemodt, '-', month_mstdefchemodt, '-', day_mstdefchemodt) AS DATE) ELSE NULL END AS mstdefchemodt, CASE WHEN year_mstdefrtdt IS NOT NULL AND month_mstdefrtdt IS NOT NULL AND day_mstdefrtdt IS NOT NULL AND isdate(concat(year_mstdefrtdt, '-', month_mstdefrtdt, '-', day_mstdefrtdt)) IS NOT NULL AND try_CONVERT(DATE, concat(year_mstdefrtdt, '-', month_mstdefrtdt, '-', day_mstdefrtdt)) <= getdate() THEN CAST(concat(year_mstdefrtdt, '-', month_mstdefrtdt, '-', day_mstdefrtdt) AS DATE) ELSE NULL END AS mstdefrtdt, CASE WHEN year_mstdefimmunodt IS NOT NULL AND month_mstdefimmunodt IS NOT NULL AND day_mstdefimmunodt IS NOT NULL AND isdate(concat(year_mstdefimmunodt, '-', month_mstdefimmunodt, '-', day_mstdefimmunodt)) IS NOT NULL AND try_CONVERT(DATE, concat(year_mstdefimmunodt, '-', month_mstdefimmunodt, '-', day_mstdefimmunodt)) <= getdate() THEN CAST(concat(year_mstdefimmunodt, '-', month_mstdefimmunodt, '-', day_mstdefimmunodt) AS DATE) ELSE NULL END AS mstdefimmunodt, CASE WHEN year_mstdefhormdt IS NOT NULL AND month_mstdefhormdt IS NOT NULL AND day_mstdefhormdt IS NOT NULL AND isdate(concat(year_mstdefhormdt, '-', month_mstdefhormdt, '-', day_mstdefhormdt)) IS NOT NULL AND try_CONVERT(DATE, concat(year_mstdefhormdt, '-', month_mstdefhormdt, '-', day_mstdefhormdt)) <= getdate() THEN CAST(concat(year_mstdefhormdt, '-', month_mstdefhormdt, '-', day_mstdefhormdt) AS DATE) ELSE NULL END AS mstdefhormdt, CASE WHEN year_mstdefrtstopdt IS NOT NULL AND month_mstdefrtstopdt IS NOT NULL AND day_mstdefrtstopdt IS NOT NULL AND isdate(concat(year_mstdefrtstopdt, '-', month_mstdefrtstopdt, '-', day_mstdefrtstopdt)) IS NOT NULL AND try_CONVERT(DATE, concat(year_mstdefrtstopdt, '-', month_mstdefrtstopdt, '-', day_mstdefrtstopdt)) <= getdate() THEN CAST(concat(year_mstdefrtstopdt, '-', month_mstdefrtstopdt, '-', day_mstdefrtstopdt) AS DATE) ELSE NULL END AS mstdefrtstopdt, CASE WHEN year_dtfirstsurg IS NOT NULL AND month_dtfirstsurg IS NOT NULL AND day_dtfirstsurg IS NOT NULL AND isdate(concat(year_dtfirstsurg, '-', month_dtfirstsurg, '-', day_dtfirstsurg)) IS NOT NULL AND try_CONVERT(DATE, concat(year_dtfirstsurg, '-', month_dtfirstsurg, '-', day_dtfirstsurg)) <= getdate() THEN CAST(concat(year_dtfirstsurg, '-', month_dtfirstsurg, '-', day_dtfirstsurg) AS DATE) ELSE NULL END AS dtfirstsurg, CASE WHEN year_dtmstdefsurg IS NOT NULL AND month_dtmstdefsurg IS NOT NULL AND day_dtmstdefsurg IS NOT NULL AND isdate(concat(year_dtmstdefsurg, '-', month_dtmstdefsurg, '-', day_dtmstdefsurg)) IS NOT NULL AND try_CONVERT(DATE, concat(year_dtmstdefsurg, '-', month_dtmstdefsurg, '-', day_dtmstdefsurg)) <= getdate() THEN CAST(concat(year_dtmstdefsurg, '-', month_dtmstdefsurg, '-', day_dtmstdefsurg) AS DATE) ELSE NULL END AS dtmstdefsurg, CASE WHEN year_dateadmis IS NOT NULL AND month_dateadmis IS NOT NULL AND day_dateadmis IS NOT NULL AND isdate(concat(year_dateadmis, '-', month_dateadmis, '-', day_dateadmis)) IS NOT NULL AND try_CONVERT(DATE, concat(year_dateadmis, '-', month_dateadmis, '-', day_dateadmis)) <= getdate() THEN CAST(concat(year_dateadmis, '-', month_dateadmis, '-', day_dateadmis) AS DATE) ELSE NULL END AS DATEadmis, CASE WHEN year_dtca_conf IS NOT NULL AND month_dtca_conf IS NOT NULL AND day_dtca_conf IS NOT NULL AND isdate(concat(year_dtca_conf, '-', month_dtca_conf, '-', day_dtca_conf)) IS NOT NULL AND try_CONVERT(DATE, concat(year_dtca_conf, '-', month_dtca_conf, '-', day_dtca_conf)) <= getdate() THEN CAST(concat(year_dtca_conf, '-', month_dtca_conf, '-', day_dtca_conf) AS DATE) ELSE NULL END AS dtca_conf, CASE WHEN year_dt2ca_conf IS NOT NULL AND month_dt2ca_conf IS NOT NULL AND day_dt2ca_conf IS NOT NULL AND isdate(concat(year_dt2ca_conf, '-', month_dt2ca_conf, '-', day_dt2ca_conf)) IS NOT NULL AND try_CONVERT(DATE, concat(year_dt2ca_conf, '-', month_dt2ca_conf, '-', day_dt2ca_conf)) <= getdate() THEN CAST(concat(year_dt2ca_conf, '-', month_dt2ca_conf, '-', day_dt2ca_conf) AS DATE) ELSE NULL END AS dt2ca_conf, CASE WHEN year_dt3ca_conf IS NOT NULL AND month_dt3ca_conf IS NOT NULL AND day_dt3ca_conf IS NOT NULL AND isdate(concat(year_dt3ca_conf, '-', month_dt3ca_conf, '-', day_dt3ca_conf)) IS NOT NULL AND try_CONVERT(DATE, concat(year_dt3ca_conf, '-', month_dt3ca_conf, '-', day_dt3ca_conf)) <= getdate() THEN CAST(concat(year_dt3ca_conf, '-', month_dt3ca_conf, '-', day_dt3ca_conf) AS DATE) ELSE NULL END AS dt3ca_conf, elapsed1stsurgchem, elapsed1stsurglstcont, elapsedchemo1stsurg, lengthtodtchemo, lengthtodthorm, lengthtodtimmuno, lengthtodtmstdefsurg, lengthtodtradstarted, lengthtodttrnsplnt, lengthtofirsttx, elapsedrtstartend, tumorsizesumm, survival, bestcssummstage, bestcstnmstage, t14udf116, t14udf117, t16udf118, abstractor, classcase, seqprim, manage_md, medoncmd, radoncmd, primsurgeon, histology, presca_conf, pres2ca_conf, pres3ca_conf, 'M' AS source_system_code, 'v_currtimestamp' AS dw_last_update_date_time FROM ( SELECT tum.tumorid AS tumorid, tum.patientid AS patientid, tum.grade AS grade, exta.casestatflag AS casestatflag, tum.primarysite AS primarysite, tum.primsitesubcode AS primsitesubcode, tum.mstdefchemosumm AS mstdefchemosumm, tum.mstdefdxstagesumm AS mstdefdxstagesumm, tum.mstdefhormsumm AS mstdefhormsumm, tum.mstdefimmunosumm AS mstdefimmunosumm, tum.mstdefmarginssumm AS mstdefmarginssumm, tum.mstdefpallsumm AS mstdefpallsumm, tum.mstdefrtboost AS mstdefrtboost, tum.mstdefrthosp AS mstdefrthosp, tum.mstdefrtloc AS mstdefrtloc, extb.reasonnochemo AS reasonnochemo, extb.reasonnohormone AS reasonnohormone, extb.reasonnoimmuno AS reasonnoimmuno, extb.reasonnorad AS reasonnorad, tum.mstdefsurgprimsumm AS mstdefsurgprimsumm, TRIM(tum.cs_ssfactor1) AS cs_ss_factor_1_num_code, TRIM(tum.cs_ssfactor2) AS cs_ss_factor_2_num_code, COALESCE(TRIM(tum.cs_ssfactor15), '') AS cs_ss_factor_15_num_code, COALESCE(TRIM(tum.cs_ssfactor16), '') AS cs_ss_factor_16_num_code, COALESCE(TRIM(tum.cs_ssfactor22), '') AS cs_ss_factor_22_num_code, COALESCE(TRIM(tum.cs_ssfactor23), '') AS cs_ss_factor_23_num_code, COALESCE(TRIM(tum.cs_ssfactor25), '') AS cs_ss_factor_25_num_code, extb.chemosrgseq AS chemosrgseq, tum.mstdefrtmod AS mstdefrtmod, tum.mstdefrtvol AS mstdefrtvol, tum.mstdefscopelnsumm AS mstdefscopelnsumm, ext2.surgapphosp AS surgapphosp, tum.mstdefsurgprimhosp AS mstdefsurgprimhosp, tum.cs_tumsize AS cs_tumsize, extb.elapsed1stsurgchem AS elapsed1stsurgchem, extb.elapsed1stsurglstcont AS elapsed1stsurglstcont, extb.elapsedchemo1stsurg AS elapsedchemo1stsurg, extb.lengthtodtchemo AS lengthtodtchemo, extb.lengthtodthorm AS lengthtodthorm, extb.lengthtodtimmuno AS lengthtodtimmuno, extb.lengthtodtmstdefsurg AS lengthtodtmstdefsurg, extb.lengthtodtradstarted AS lengthtodtradstarted, extb.lengthtodttrnsplnt AS lengthtodttrnsplnt, extb.lengthtofirsttx AS lengthtofirsttx, extb.elapsedrtstartend AS elapsedrtstartend, exta.tumorsizesumm AS tumorsizesumm, tum.survival AS survival, tum.bestcssummstage AS bestcssummstage, TRIM(tum.beststage) AS bestcstnmstage, tum14.t14udf116 AS t14udf116, tum14.t14udf117 AS t14udf117, tum16.t16udf118 AS t16udf118, TRIM(exta.abstractor) AS abstractor, exta.classcase AS classcase, exta.seqprim AS seqprim, extb.manage_md AS manage_md, extb.medoncmd AS medoncmd, extb.radoncmd AS radoncmd, extb.primsurgeon AS primsurgeon, tum.histology AS histology, extb.presca_conf, extb.pres2ca_conf, extb.pres3ca_conf AS pres3ca_conf, CASE WHEN LEN(RTRIM(CONVERT(numeric, dateadmis))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, dateadmis)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, dateadmis)), 7, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, dateadmis)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, dateadmis)), 7, 2) END ELSE NULL END AS day_dateadmis, CASE WHEN LEN(RTRIM(CONVERT(numeric, dt2ca_conf))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, dt2ca_conf)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, dt2ca_conf)), 7, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, dt2ca_conf)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, dt2ca_conf)), 7, 2) END ELSE NULL END AS day_dt2ca_conf, CASE WHEN LEN(RTRIM(CONVERT(numeric, dt3ca_conf))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, dt3ca_conf)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, dt3ca_conf)), 7, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, dt3ca_conf)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, dt3ca_conf)), 7, 2) END ELSE NULL END AS day_dt3ca_conf, CASE WHEN LEN(RTRIM(CONVERT(numeric, dtca_conf))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, dtca_conf)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, dtca_conf)), 7, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, dtca_conf)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, dtca_conf)), 7, 2) END ELSE NULL END AS day_dtca_conf, CASE WHEN LEN(RTRIM(CONVERT(numeric, dtfirstsurg))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, dtfirstsurg)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, dtfirstsurg)), 7, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, dtfirstsurg)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, dtfirstsurg)), 7, 2) END ELSE NULL END AS day_dtfirstsurg, CASE WHEN LEN(RTRIM(CONVERT(numeric, dtmstdefsurg))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, dtmstdefsurg)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, dtmstdefsurg)), 7, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, dtmstdefsurg)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, dtmstdefsurg)), 7, 2) END ELSE NULL END AS day_dtmstdefsurg, CASE WHEN LEN(RTRIM(CONVERT(numeric, mstdefchemodt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, mstdefchemodt)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, mstdefchemodt)), 7, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, mstdefchemodt)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, mstdefchemodt)), 7, 2) END ELSE NULL END AS day_mstdefchemodt, CASE WHEN LEN(RTRIM(CONVERT(numeric, mstdefhormdt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, mstdefhormdt)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, mstdefhormdt)), 7, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, mstdefhormdt)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, mstdefhormdt)), 7, 2) END ELSE NULL END AS day_mstdefhormdt, CASE WHEN LEN(RTRIM(CONVERT(numeric, mstdefimmunodt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, mstdefimmunodt)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, mstdefimmunodt)), 7, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, mstdefimmunodt)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, mstdefimmunodt)), 7, 2) END ELSE NULL END AS day_mstdefimmunodt, CASE WHEN LEN(RTRIM(CONVERT(numeric, mstdefrtdt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, mstdefrtdt)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, mstdefrtdt)), 7, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, mstdefrtdt)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, mstdefrtdt)), 7, 2) END ELSE NULL END AS day_mstdefrtdt, CASE WHEN LEN(RTRIM(CONVERT(numeric, mstdefrtstopdt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, mstdefrtstopdt)), 7, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, mstdefrtstopdt)), 7, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, mstdefrtstopdt)), 7, 2)) > 31 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, mstdefrtstopdt)), 7, 2) END ELSE NULL END AS day_mstdefrtstopdt, CASE WHEN LEN(RTRIM(CONVERT(numeric, dateadmis))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, dateadmis)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, dateadmis)), 5, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, dateadmis)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, dateadmis)), 5, 2) END ELSE NULL END AS month_dateadmis, CASE WHEN LEN(RTRIM(CONVERT(numeric, dt2ca_conf))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, dt2ca_conf)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, dt2ca_conf)), 5, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, dt2ca_conf)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, dt2ca_conf)), 5, 2) END ELSE NULL END AS month_dt2ca_conf, CASE WHEN LEN(RTRIM(CONVERT(numeric, dt3ca_conf))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, dt3ca_conf)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, dt3ca_conf)), 5, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, dt3ca_conf)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, dt3ca_conf)), 5, 2) END ELSE NULL END AS month_dt3ca_conf, CASE WHEN LEN(RTRIM(CONVERT(numeric, dtca_conf))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, dtca_conf)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, dtca_conf)), 5, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, dtca_conf)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, dtca_conf)), 5, 2) END ELSE NULL END AS month_dtca_conf, CASE WHEN LEN(RTRIM(CONVERT(numeric, dtfirstsurg))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, dtfirstsurg)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, dtfirstsurg)), 5, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, dtfirstsurg)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, dtfirstsurg)), 5, 2) END ELSE NULL END AS month_dtfirstsurg, CASE WHEN LEN(RTRIM(CONVERT(numeric, dtmstdefsurg))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, dtmstdefsurg)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, dtmstdefsurg)), 5, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, dtmstdefsurg)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, dtmstdefsurg)), 5, 2) END ELSE NULL END AS month_dtmstdefsurg, CASE WHEN LEN(RTRIM(CONVERT(numeric, mstdefchemodt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, mstdefchemodt)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, mstdefchemodt)), 5, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, mstdefchemodt)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, mstdefchemodt)), 5, 2) END ELSE NULL END AS month_mstdefchemodt, CASE WHEN LEN(RTRIM(CONVERT(numeric, mstdefhormdt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, mstdefhormdt)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, mstdefhormdt)), 5, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, mstdefhormdt)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, mstdefhormdt)), 5, 2) END ELSE NULL END AS month_mstdefhormdt, CASE WHEN LEN(RTRIM(CONVERT(numeric, mstdefimmunodt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, mstdefimmunodt)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, mstdefimmunodt)), 5, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, mstdefimmunodt)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, mstdefimmunodt)), 5, 2) END ELSE NULL END AS month_mstdefimmunodt, CASE WHEN LEN(RTRIM(CONVERT(numeric, mstdefrtdt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, mstdefrtdt)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, mstdefrtdt)), 5, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, mstdefrtdt)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, mstdefrtdt)), 5, 2) END ELSE NULL END AS month_mstdefrtdt, CASE WHEN LEN(RTRIM(CONVERT(numeric, mstdefrtstopdt))) = 8 THEN CASE WHEN SUBSTRING(RTRIM(CONVERT(numeric, mstdefrtstopdt)), 5, 2) = '99' OR SUBSTRING(RTRIM(CONVERT(numeric, mstdefrtstopdt)), 5, 2) = '00' THEN '01' WHEN try_CONVERT(INT, SUBSTRING(RTRIM(CONVERT(numeric, mstdefrtstopdt)), 5, 2)) > 12 THEN NULL ELSE SUBSTRING(RTRIM(CONVERT(numeric, mstdefrtstopdt)), 5, 2) END ELSE NULL END AS month_mstdefrtstopdt, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, dateadmis)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, dateadmis))), 1, 4) ELSE NULL END AS year_dateadmis, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, dt2ca_conf)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, dt2ca_conf))), 1, 4) ELSE NULL END AS year_dt2ca_conf, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, dt3ca_conf)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, dt3ca_conf))), 1, 4) ELSE NULL END AS year_dt3ca_conf, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, dtca_conf)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, dtca_conf))), 1, 4) ELSE NULL END AS year_dtca_conf, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, dtfirstsurg)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, dtfirstsurg))), 1, 4) ELSE NULL END AS year_dtfirstsurg, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, dtmstdefsurg)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, dtmstdefsurg))), 1, 4) ELSE NULL END AS year_dtmstdefsurg, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, mstdefchemodt)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, mstdefchemodt))), 1, 4) ELSE NULL END AS year_mstdefchemodt, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, mstdefhormdt)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, mstdefhormdt))), 1, 4) ELSE NULL END AS year_mstdefhormdt, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, mstdefimmunodt)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, mstdefimmunodt))), 1, 4) ELSE NULL END AS year_mstdefimmunodt, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, mstdefrtdt)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, mstdefrtdt))), 1, 4) ELSE NULL END AS year_mstdefrtdt, CASE WHEN LEN(LTRIM(RTRIM(CONVERT(numeric, mstdefrtstopdt)))) = 8 THEN SUBSTRING(LTRIM(RTRIM(CONVERT(numeric, mstdefrtstopdt))), 1, 4) ELSE NULL END AS year_mstdefrtstopdt FROM mregistry.dbo.tumor tum LEFT OUTER JOIN mregistry.dbo.tumorext1b extb ON tum.tumorid = extb.tumorid LEFT OUTER JOIN mregistry.dbo.tumorext1a exta ON tum.tumorid = exta.tumorid LEFT OUTER JOIN mregistry.dbo.tumorext2 ext2 ON tum.tumorid = ext2.tumorid LEFT OUTER JOIN mregistry.dbo.tumorext14 tum14 ON tum.tumorid = tum14.tumorid LEFT OUTER JOIN mregistry.dbo.tumorext16 tum16 ON tum.tumorid = tum16.tumorid ) mm;